<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>安康学院校园墙小程序（全栈） | 铸鼎_</title><meta name="author" content="付鼎"><meta name="copyright" content="付鼎"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="开放源代码 本项目，由于工作没时间折腾，它的前后端代码已经在Gitee上开源，但最重要的是为了共同学习为目的，互相学习。 源码: school_wall（前端） school_wall（后端）  推荐阅读 参考： MarkerHub： Java 代码的14个好习惯  API规划RESTful API REST （英文：Representational State Transfer ，简称 REST">
<meta property="og:type" content="article">
<meta property="og:title" content="安康学院校园墙小程序（全栈）">
<meta property="og:url" content="https://ding-f.github.io/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji">
<meta property="og:site_name" content="铸鼎_">
<meta property="og:description" content="开放源代码 本项目，由于工作没时间折腾，它的前后端代码已经在Gitee上开源，但最重要的是为了共同学习为目的，互相学习。 源码: school_wall（前端） school_wall（后端）  推荐阅读 参考： MarkerHub： Java 代码的14个好习惯  API规划RESTful API REST （英文：Representational State Transfer ，简称 REST">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ding-f.github.io/images/java_dev/graduate.jpg">
<meta property="article:published_time" content="2022-02-13T14:04:33.000Z">
<meta property="article:modified_time" content="2024-11-25T17:23:15.108Z">
<meta property="article:author" content="付鼎">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JavaEE">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="理论">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="后端">
<meta property="article:tag" content="微服务">
<meta property="article:tag" content="小程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ding-f.github.io/images/java_dev/graduate.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ding-f.github.io/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '安康学院校园墙小程序（全栈）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-26 01:23:15'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/logo.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/java_dev/graduate.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="铸鼎_"><img class="site-icon" src="/images/logo.png"/><span class="site-name">铸鼎_</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">安康学院校园墙小程序（全栈）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-02-13T14:04:33.000Z" title="发表于 2022-02-13 22:04:33">2022-02-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-25T17:23:15.108Z" title="更新于 2024-11-26 01:23:15">2024-11-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%BC%80%E5%8F%91/">开发</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">27.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>118分钟</span></span><span class="post-meta-separator">|</span><span class="leancloud_visitors" id="/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji" data-flag-title="安康学院校园墙小程序（全栈）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span class="leancloud-visitors-count"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji#post-comment" itemprop="discussionUrl"><span class="valine-comment-count" data-xid="/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji" itemprop="commentCount"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="开放源代码"><a href="#开放源代码" class="headerlink" title="开放源代码"></a>开放源代码</h2><blockquote>
<p>本项目，由于工作没时间折腾，它的前后端代码已经在Gitee上开源，但最重要的是为了共同学习为目的，互相学习。</p>
<p>源码:</p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/ding-f/school-wall-front-end">school_wall（前端）</a></p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/ding-f/school-wall-backend">school_wall（后端）</a></p>
</blockquote>
<h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/L0Uh8bzQw589nR3TcwVuaw">MarkerHub： Java 代码的14个好习惯</a></p>
</blockquote>
<h2 id="API规划"><a href="#API规划" class="headerlink" title="API规划"></a>API规划</h2><h3 id="RESTful-API"><a href="#RESTful-API" class="headerlink" title="RESTful API"></a>RESTful API</h3><blockquote>
<p>REST （英文：Representational State Transfer ，简称 REST ）</p>
<p>一种互联网软件架构设计的风格，但它并不是标准，它只是提出了一组客户端和服务器交互时的架构理念和设计原则，基于这种理念和原则设计的接口可以更简洁，更有层次，REST这个词，是 Roy Thomas Fielding 在他 2000 年的博士论文中提出的。</p>
<p>任何的技术都可以实现这种理念，如果一个架构符合 REST 原则，就称它为 RESTFul 架构。</p>
<p>REST 是 Representational State Transfer的缩写，如果一个架构符合REST原则，就称它为RESTful架构。</p>
<p>RESTful 架构可以充分的利用 HTTP 协议的各种功能，是 HTTP 协议的最佳实践。</p>
<p>RESTful API 是一种软件架构风格、设计风格，可以让软件更加清晰，更简洁，更有层次，可维护性更好。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://restfulapi.cn/">RESTful API</a></p>
<p><a target="_blank" rel="noopener" href="https://danielmiessler.com/study/difference-between-uri-url/">The Difference Between a URL, URI, and a URN</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43823808/article/details/116894611">CSDN:SpringBoot中使用RESTful风格</a></p>
</blockquote>
<h4 id="请求-动词-宾语"><a href="#请求-动词-宾语" class="headerlink" title="请求 &#x3D; 动词 + 宾语"></a>请求 &#x3D; 动词 + 宾语</h4><p>动词（五种方法）：</p>
<ul>
<li>GET（查）—————— Retrieve（译：检索）</li>
<li>POST（增）—————— Create（译：创建）</li>
<li>PUT（改）—————— Update（译：更新）</li>
<li>PATCH（改）—————— Update（通常部分更新）</li>
<li>DELETE（删）—————— Delete（译：删除）</li>
</ul>
<h4 id="API-响应设计"><a href="#API-响应设计" class="headerlink" title="API 响应设计"></a>API 响应设计</h4><p><img src="/images/java_dev/rest_ful_code.png" alt="响应码"></p>
<ul>
<li><p>客户端的每一次请求，服务器都必须给出回应。回应包括 HTTP 状态码和数据两部分。</p>
</li>
<li><p>五大类状态码，总共100多种，覆盖了绝大部分可能遇到的情况。每一种状态码都有约定的解释，客户端只需查看状态码，就可以判断出发生了什么情况。API 不需要1xx状态码。</p>
</li>
</ul>
<h4 id="服务器回应数据"><a href="#服务器回应数据" class="headerlink" title="服务器回应数据"></a>服务器回应数据</h4><ul>
<li><p>客户端请求时，要明确告诉服务器，接受 JSON 格式，请求的 HTTP 头的 ACCEPT 属性要设成 application&#x2F;json</p>
</li>
<li><p>服务端返回的数据，不应该是纯文本，而应该是一个 JSON 对象。服务器回应的 HTTP 头的 Content-Type 属性要设为 application&#x2F;json</p>
</li>
<li><p>错误处理 如果状态码是4xx，就应该向用户返回出错信息。一般来说，返回的信息中将 error 作为键名，出错信息作为键值即可。 {error: “Invalid API key”}</p>
</li>
<li><p>认证 RESTful API 应该是无状态，每个请求应该带有一些认证凭证。推荐使用 JWT 认证，并且使用 SSL</p>
</li>
<li><p>Hypermedia 即返回结果中提供链接，连向其他API方法，使得用户不查文档，也知道下一步应该做什么</p>
</li>
</ul>
<h3 id="API管理工具Swagger3"><a href="#API管理工具Swagger3" class="headerlink" title="API管理工具Swagger3"></a>API管理工具Swagger3</h3><blockquote>
<p>详细：</p>
<p><a target="_blank" rel="noopener" href="https://ding-f.gitee.io/2022/06/28/swagger3.html">铸鼎：SpringBoot Swagger3</a></p>
</blockquote>
<h3 id="小程序首页"><a href="#小程序首页" class="headerlink" title="小程序首页"></a>小程序首页</h3><h4 id="首页轮播图和精选内容"><a href="#首页轮播图和精选内容" class="headerlink" title="首页轮播图和精选内容"></a>首页轮播图和精选内容</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/options/homeconfig">http://0.0.0.0:3000/schoolwall/options/homeconfig</a></p>
<ul>
<li><p>后端实现</p>
<p><img src="/images/java_dev/image-20220312163547769.png" alt="后端效果"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-29_15.42.21.gif" alt="前端效果"></p>
</li>
</ul>
<h4 id="10篇帖子为1页，分页获取列表"><a href="#10篇帖子为1页，分页获取列表" class="headerlink" title="10篇帖子为1页，分页获取列表"></a>10篇帖子为1页，分页获取列表</h4><p>旧：<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts?per_page=10&orderby=date&order=desc&page=X">http://0.0.0.0:3000/schoolwall/posts?per_page=10&amp;orderby=date&amp;order=desc&amp;page=X</a></p>
<p>新：<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=%7B%7D">http://0.0.0.0:3000/schoolwall/posts/page={}</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>page&#x3D;{}</td>
<td>Int</td>
<td>变量从1开始一直+1来获取分页后的下一页内容，每页包含10篇帖子。</td>
</tr>
</tbody></table>
<ul>
<li><p>后端实现</p>
<p><img src="/images/java_dev/image-20220312164309299.png" alt="后端效果"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-29_15.47.04.gif" alt="前端效果"></p>
</li>
</ul>
<h4 id="根据帖子ID获取帖子详细信息"><a href="#根据帖子ID获取帖子详细信息" class="headerlink" title="根据帖子ID获取帖子详细信息"></a>根据帖子ID获取帖子详细信息</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getpost/id=%7B%7D">http://0.0.0.0:3000/schoolwall/getpost/id={}</a></p>
<ul>
<li><p>后端实现</p>
<p><img src="/images/java_dev/image-20220318152359448.png" alt="后端效果"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-29_15.51.38.gif" alt="2022-03-29 15.51.38"></p>
</li>
</ul>
<h4 id="根据帖子ID获取评论列表并实现翻页"><a href="#根据帖子ID获取评论列表并实现翻页" class="headerlink" title="根据帖子ID获取评论列表并实现翻页"></a>根据帖子ID获取评论列表并实现翻页</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcomments/postid=%7B%7D/commentspage=%7B%7D">http://0.0.0.0:3000/schoolwall/getcomments/postid={}/commentspage={}</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>postid&#x3D;{}</td>
<td>Long</td>
<td>帖子ID（主键）</td>
</tr>
<tr>
<td>commentspage&#x3D;{}</td>
<td>Int</td>
<td>评论分页的页数</td>
</tr>
</tbody></table>
<ul>
<li><p>后端实现</p>
<blockquote>
<p>详细实现过程：</p>
<ol>
<li>数据库设计 &gt; 数据分析 &gt; 评论列表</li>
<li>后端开发 &gt; MyBatis &gt; Bilibili评论列表</li>
<li>前端开发 &gt; Bilibili评论列表</li>
</ol>
</blockquote>
<p>由于涉及到多表查询，MyBatis Plus 没有提供相应的多表查询便捷方式，由于MyBatis Plus当然是基于MyBatis 开发的，直接就可以在MyBatis Plus里的生成器生成相应的xxxMapper.xml直接可以写出一个很长的多表查询的语句进行多表查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> f.id <span class="keyword">as</span> f_id,u.nick_name <span class="keyword">as</span> f_nick_name,u.avatar_url <span class="keyword">as</span> f_avatar_url,f.content <span class="keyword">as</span> f_content,f.father_reply_date <span class="keyword">as</span>  f_father_reply_date,  s.id <span class="keyword">as</span> s_id,su.nick_name <span class="keyword">as</span> s_nick_name,su.avatar_url <span class="keyword">as</span> s_avatar_url,s.content <span class="keyword">as</span> s_content,s.receiver_nick <span class="keyword">as</span> s_receiver_nick,s.son_reply_date <span class="keyword">as</span> s_son_reply_date <span class="keyword">from</span> sw_father_reply f <span class="keyword">left</span> <span class="keyword">join</span> sw_user u <span class="keyword">on</span> user_id<span class="operator">=</span>u.id <span class="keyword">left</span> <span class="keyword">join</span> sw_son_reply s <span class="keyword">on</span> father_reply_id<span class="operator">=</span>f.id <span class="keyword">left</span> <span class="keyword">join</span> sw_user su <span class="keyword">on</span> su.id<span class="operator">=</span>s.user_id <span class="keyword">where</span> f.post_id<span class="operator">=</span><span class="number">123</span> <span class="keyword">order</span> <span class="keyword">by</span> father_reply_date <span class="keyword">asc</span>, son_reply_date <span class="keyword">asc</span> ;</span><br></pre></td></tr></table></figure>

<p><img src="/images/java_dev/image-20220321234745024.png" alt="image-20220321234745024"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-29_14.44.35.gif" alt="2022-03-29 14.44.35"></p>
</li>
</ul>
<h3 id="小程序分类页"><a href="#小程序分类页" class="headerlink" title="小程序分类页"></a>小程序分类页</h3><h4 id="获取帖子分类列表并计算类别下贴子数"><a href="#获取帖子分类列表并计算类别下贴子数" class="headerlink" title="获取帖子分类列表并计算类别下贴子数"></a>获取帖子分类列表并计算类别下贴子数</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/categories">http://0.0.0.0:3000/schoolwall/categories</a></p>
<ul>
<li><p>后端实现</p>
<blockquote>
<p>详细实现过程：</p>
<ol>
<li>数据库设计 &gt; 数据分析 &gt; 帖子分类并计数</li>
<li>后端开发 &gt; MyBatis &gt; 帖子分类列表</li>
</ol>
</blockquote>
<p>以下需要分类列表和帖子列表进行一个统计，统计出各类列表的帖子的数目，一样不能使用MyBatis Plus提供的增强功能。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> spc.id,spc.name ,spc.description,spc.category_thumbnail_image,<span class="built_in">count</span>(sp.id) <span class="keyword">as</span> posts_count <span class="keyword">from</span> sw_post_categories spc <span class="keyword">left</span> <span class="keyword">join</span> sw_posts sp <span class="keyword">on</span> sp.category_id<span class="operator">=</span>spc.id <span class="keyword">group</span> <span class="keyword">by</span> spc.id  <span class="keyword">order</span> <span class="keyword">by</span> posts_count <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p><img src="/images/java_dev/image-20220330144831852.png" alt="image-20220330144831852"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-29_15.57.13.gif" alt="2022-03-29 15.57.13"></p>
</li>
</ul>
<h4 id="根据分类ID获取某个分类信息"><a href="#根据分类ID获取某个分类信息" class="headerlink" title="根据分类ID获取某个分类信息"></a>根据分类ID获取某个分类信息</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcategorie/id=%7B%7D">http://0.0.0.0:3000/schoolwall/getcategorie/id={}</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id&#x3D;{}</td>
<td>Int</td>
<td>分类表ID（主键）</td>
</tr>
</tbody></table>
<ul>
<li><p>后端实现</p>
<blockquote>
<p>详细实现过程：</p>
<ol>
<li>数据库设计 &gt; 数据分析 &gt; 帖子分类</li>
<li>后端开发 &gt; MyBatis Plus &gt; 根据某个ID获取某个分类信息</li>
</ol>
</blockquote>
<p><img src="/images/java_dev/image-20220330145824482.png" alt="image-20220330145824482"></p>
</li>
<li><p>前端实现</p>
<p> <img src="/images/java_dev/image-20220331172533351.png" alt="image-20220331172533351"></p>
</li>
</ul>
<h4 id="根据分类ID获取所有该ID下的帖子并翻页"><a href="#根据分类ID获取所有该ID下的帖子并翻页" class="headerlink" title="根据分类ID获取所有该ID下的帖子并翻页"></a>根据分类ID获取所有该ID下的帖子并翻页</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=%7B%7D/categorieid=%7B%7D">http://0.0.0.0:3000/schoolwall/posts/page={}/categorieid={}</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>page&#x3D;{}</td>
<td>Int</td>
<td>分页页面数</td>
</tr>
<tr>
<td>categorieid&#x3D;{}</td>
<td>Int</td>
<td>分类表ID（主键）</td>
</tr>
</tbody></table>
<ul>
<li><p>后端实现</p>
<blockquote>
<p>详细实现过程：</p>
<ol>
<li>数据库设计 &gt; 数据分析 &gt; 根据分类ID获取所有该ID下的帖子并翻页 </li>
<li>后端开发 &gt; MyBatis plus &gt; 根据分类ID获取所有该ID下的帖子并翻页</li>
</ol>
</blockquote>
<p><img src="/images/java_dev/image-20220330171317264.png" alt="分类ID=3文章列表的第1页"></p>
<p><img src="/images/java_dev/image-20220330171435743.png" alt="分类ID=3文章列表的第2页"></p>
</li>
<li><p>前端实现</p>
<p><img src="/images/java_dev/2022-03-31_17.04.13.gif" alt="2022-03-31 17.04.13"></p>
</li>
</ul>
<h4 id="搜索文章或标题功能的实现"><a href="#搜索文章或标题功能的实现" class="headerlink" title="搜索文章或标题功能的实现"></a>搜索文章或标题功能的实现</h4><p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=%7B%7D/search=%7B%7D">http://0.0.0.0:3000/schoolwall/posts/page={}/search={}</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>page&#x3D;{}</td>
<td>Int</td>
<td>搜素结果分页，页面号</td>
</tr>
<tr>
<td>search&#x3D;{}</td>
<td>String</td>
<td>搜索关键字</td>
</tr>
</tbody></table>
<ul>
<li><p>后端实现</p>
<blockquote>
<p>详细实现过程：</p>
<ol>
<li>数据库设计 &gt; 数据分析 &gt; 10篇帖子为1页，分页获取列表（基本相似）</li>
<li>后端开发 &gt; MyBatis Plus &gt; 搜索文章或标题功能的实现</li>
</ol>
</blockquote>
<p><img src="/images/java_dev/image-20220402162340864.png" alt="搜索“伞”关键字，第一页"></p>
<p><img src="/images/java_dev/image-20220402162457906.png" alt="搜索“伞”关键字，第二页"></p>
</li>
<li><p>前端实现</p>
<p>![2022-04-02 16.30.37](&#x2F;images&#x2F;java_dev&#x2F;2022-04-02 16.30.37.png)</p>
</li>
</ul>
<h2 id="后端开发"><a href="#后端开发" class="headerlink" title="后端开发"></a>后端开发</h2><blockquote>
<p>后端开发选用目前最流行的<code>Spring Boot</code>进行各种依赖的整合。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.zhuawaba.com/post/17#3%E3%80%81%E6%95%B4%E5%90%88mybatis%20plus">超详细！4小时开发一个SpringBoot+vue前后端分离博客项目！！</a></p>
</blockquote>
<h3 id="IntelliJ-IDEA"><a href="#IntelliJ-IDEA" class="headerlink" title="IntelliJ IDEA"></a>IntelliJ IDEA</h3><blockquote>
<p>主要是方便写代码，方便配置。</p>
<p>推荐：</p>
<p><a target="_blank" rel="noopener" href="https://www.jetbrains.com/community/education/#students">Free Educational Licenses（申请学生认证提供免费使用）</a></p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/de544b13b9d5">springboot热部署之spring-boot-devtools</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/146659383">为什么要放弃 Lombok</a></p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/">MyBatis-Plus</a></p>
</blockquote>
<h4 id="创建一个Project"><a href="#创建一个Project" class="headerlink" title="创建一个Project"></a>创建一个Project</h4><p>配置Maven：</p>
<blockquote>
<p>IDEA本来就带有Maven，但是每次都需要联网去外网中心仓库下载才可以进行项目的开发，所以不建议直接使用，直接替换原有的Maven，设置仓库为国内源即可顺利进行开发。</p>
</blockquote>
<ul>
<li><p>点击<code>File&gt;Settings&gt;Build,Execution,Deployment&gt;Bilud Tools&gt;Maven</code>进入Maven的配置</p>
<p>直接更改maven的本地所在路径即可:</p>
<p><img src="/images/java_dev/idea_maven.png" alt="Maven配置"></p>
</li>
</ul>
<p>打开IDEA，创建一个Web项目：</p>
<ul>
<li><p>New Project&gt;Srping Initializr&gt;</p>
<ul>
<li>填写好项目名称</li>
<li>存放了路径</li>
<li>包名称，例如com.schoolwall，以后的项目代码就全在这个目录下创建。</li>
</ul>
</li>
<li><p>选择自己适应的Spring Boot版本</p>
<ul>
<li>Developer Tools&gt;勾选Spring Boot DevTools</li>
<li>Web&gt;勾选Lombok、勾选Spring Web</li>
<li>SQL&gt;勾选MySQL Driver</li>
</ul>
<p><img src="/images/java_dev/spring_boot_frist.png" alt="Srping Boot项目配置"></p>
</li>
</ul>
<h4 id="IDEA新创建一个Mode"><a href="#IDEA新创建一个Mode" class="headerlink" title="IDEA新创建一个Mode"></a>IDEA新创建一个Mode</h4><blockquote>
<p>这个步骤主要是项目需要一个文件管理，发布墙贴的时候需要进行文件管理。</p>
<p>详细实现过程：</p>
<p>后端开发 &gt; 文件上传下载</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35246620/article/details/65448689">IntelliJ IDEA 中 Project 和 Module 的概念及区别</a></p>
</blockquote>
<p><strong>IDEA创建一个Module</strong></p>
<p>这个过程其实就是IDEA帮你写了一个Maven的文件包含进去创建Module时候选择的依赖Jar包并做了相应的Spring Boot配置（创建Project其实一个道理）。</p>
<p><img src="/images/java_dev/image-20220508120910378.png" alt="IDEA pom.xml对应关系"></p>
<p><strong>选择Jar依赖</strong></p>
<p><img src="/images/java_dev/image-20220507000324036.png" alt="选择Jar包"></p>
<ul>
<li>点击Finish即可创建完成</li>
<li>每个Jar依赖包的功能就在右边有解释。</li>
</ul>
<p><strong>创建结果</strong></p>
<p>下面是创建的目录，自己品味一下该如何填写Group和Artifact了吧？</p>
<p><img src="/images/java_dev/image-20220508121423680.png" alt="创建的目录会是这样"></p>
<p><strong>改名跑配置文件</strong></p>
<p>后缀改为<code>.yml</code>，记得要安装一个识别yml的插件。</p>
<p><img src="/images/java_dev/image-20220508174507603.png" alt="image-20220508174507603"></p>
<p>创建多个Module互相不干扰，直接配置不同的服务器端口可以提供多个后端。</p>
<h3 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h3><blockquote>
<p>使得Java依赖jar包的导入更加方便便捷，以往使用的比如String就要导入除了spring.jar文件，Spring还包括有其它13个独立的jar包<a target="_blank" rel="noopener" href="https://zhidao.baidu.com/question/268317690411075405.html">Spring需要哪些jar包</a>，有了Maven就可以非常迅速的手动写入<code>pom.xml</code>配置文件（Maven配置文件），来导入所需的Jar包。</p>
<p>详细请查看本博客Maven帖子。</p>
</blockquote>
<p>例如：导入包含Srping Boot、SpringMVC、MyBatis Plus、等…基本jar包：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>myproject<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Additional lines to be added here... --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>spring-boot-starter-parent</code> 作用是提供了有用的Maven默认值，依赖项管理部分，可为有意义的依赖项省略版本标记。</p>
<ul>
<li>在配置导入一个Spring Boot 项目到IDEA时会用到pom.xml文件，你会发现<code>&lt;parent&gt;&lt;/parent&gt;</code>包含的就是<code>spring-boot-starter-parent</code>这个jar文件，原因就是Spring Boot也是是一个Maven管理的项目，也就是说所有的内部依赖都是基于Maven来进行依赖管理的。</li>
</ul>
</li>
<li><p>设计一个web的项目就必须添加一个<code>spring-boot-starter-web</code>的依赖（嵌入Tomcat）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


</li>
<li><p>使用以下命令打印出Maven项目的依赖树。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn dependency:tree</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h3><blockquote>
<p>Spring Boot helps you to create stand-alone, production-grade Spring-based applications that you can run. We take an opinionated view of the Spring platform and third-party libraries, so that you can get started with minimum fuss. Most Spring Boot applications need very little Spring configuration.</p>
<p>Spring Boot帮助您创建可以运行的独立的、生产级的基于Spring的应用程序。我们对Spring平台和第三方库有自己的看法，因此您在开始时不会有太多麻烦。</p>
<p>You can use Spring Boot to create Java applications that can be started by using <code>java -jar</code> or more traditional war deployments. We also provide a command line tool that runs “spring scripts”.</p>
<p>大多数Spring Boot应用程序只需要很少的Spring配置。您可以使用Spring Boot创建Java应用程序，这些程序可以通过使用Java -jar或更传统的战争部署启动。我们还提供了一个运行spring脚本的命令行工具。</p>
<p>Our primary goals are:</p>
<p>我们的主要目标是:</p>
<ul>
<li><p>Provide a radically faster and widely accessible getting-started experience for all Spring development.</p>
</li>
<li><p>为所有Spring开发提供更加快速和广泛的入门体验。</p>
</li>
<li><p>Be opinionated out of the box but get out of the way quickly as requirements start to diverge from the defaults.</p>
</li>
<li><p>坚持己见，开箱即用，但当需求开始偏离默认值时，要迅速闪开。</p>
</li>
<li><p>Provide a range of non-functional features that are common to large classes of projects (such as embedded servers, security, metrics, health checks, and externalized configuration).</p>
</li>
<li><p>提供一系列非功能性的特性，这些特性对于大型项目(如嵌入式服务器、安全性、指标、健康检查和外部化配置)来说是常见的。</p>
</li>
<li><p>Absolutely no code generation and no requirement for XML configuration.</p>
</li>
<li><p>绝对不需要生成代码，也不需要XML配置。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1792008#:~:text=%E6%80%BB%E7%BB%93%20%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9D%A5%E8%AF%B4%20Spring%20%E5%B0%B1%E6%98%AF%E4%B8%80%E4%B8%AA%E6%A1%86%E6%9E%B6%EF%BC%8CSpring%20Boot%20%E6%98%AF%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%A1%86%E6%9E%B6%E4%B8%8A%E8%BF%90%E8%A1%8C%E7%9A%84%E4%B8%80%E4%B8%AA%E6%89%A9%E5%B1%95%EF%BC%8C%E4%B8%BB%E8%A6%81%E4%B8%BA%E4%BA%86%E8%A7%A3%E5%86%B3%20%E6%95%8F%E6%8D%B7%E5%BC%80%E5%8F%91,%E5%92%8C%E9%83%A8%E7%BD%B2%E7%9A%84%E9%97%AE%E9%A2%98%E3%80%82%20Spring%20%E6%A1%86%E6%9E%B6%E6%98%AF%E7%81%B5%E9%AD%82%EF%BC%8C%E6%B2%A1%E6%9C%89%20Spring%20%E6%A1%86%E6%9E%B6%E5%B0%B1%E6%B2%A1%E6%9C%89%20Spring%20Boot%E3%80%82">腾讯云-HoneyMoose：Spring 和 Spring Boot</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/2.6.3/reference/html/getting-started.html#getting-started.first-application.pom">Introducing Spring Boot</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40753536/article/details/81285046">SpringBoot注解最全详解(整合超详细版本)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/de544b13b9d5">springboot热部署之spring-boot-devtools</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/magi1201/article/details/82226289">CSDN：@RequestMapping和@GetMapping @PostMapping 区别</a></p>
</li>
</ul>
</blockquote>
<p>IDEA生成只带有Spring Boot 2.7.1的Maven pom.xml，可看出Spring Boot配置成功都需要哪些Jar包。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>以下代码来自官网对Spring Boot 产品的简单介绍：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>		<span class="comment">//可换为@SpringBootConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/&quot;)</span></span><br><span class="line">    String <span class="title function_">home</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(MyApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@RequestMapping是最普通的写法，更简便的写法比如@GetMaping @POSTMapping 即，直接定义Get方式还是Post方式。</li>
<li>@RestController（@ResponseBody 和Controller的合集）。<ul>
<li>@Controller将Class注册为Bean。</li>
<li>@ResponseBody：表示该方法的返回结果直接写入HTTP response body中，一般在异步获取数据时使用，用于构建RESTful的api。</li>
<li>@RequestMapping添加后，返回值通常解析为跳转路径，加上@ResponseBody后返回结果不会被解析为跳转路径，而是直接写入HTTP response body中。比如异步获取json数据，加上@Responsebody后，会直接返回json数据，而解析成json主要是Spring 中的jackson在起作用。</li>
<li>@ResponseBody和@RequestMapping经常一起使用。</li>
</ul>
</li>
<li>@EnableAutoConfiguration 基于添加的依赖，告诉Spring Boot如何配置Srping。</li>
<li>main方法：Spring Boot依旧遵循Java程序入口规则，主方法通过调用run来委托Srping Boot的SpringApplication类，SrpingApplication启动所需应用程序、启动Spring、启动自动配置的Tomcat，所以我们要将MyApplication.class作为参数传递给run方法，告知那个组件是String的主组件。</li>
<li>@SpringBootConfiguration，包含三种，@Component、@EnableAutoConfiguration、@ComponentScan。</li>
</ul>
<h4 id="配置Spring-Boot去除Json-Null值元素"><a href="#配置Spring-Boot去除Json-Null值元素" class="headerlink" title="配置Spring Boot去除Json Null值元素"></a>配置Spring Boot去除Json Null值元素</h4><blockquote>
<p>前后端分离项目中，我使用的MyBatis Plus，但其中有一个查询出部分字段的方法返回的实体类生成的JSON里面不需要查询的属性也显示出来了，但它们显示的全是null值，对于一个强迫症的程序员来说这个是非常闹心的一个问题，而且再考虑到以后的项目搭建到阿里云服务器，这个虽然只有那么10几个B的带宽占用，那也是带宽啊，所以决定去掉这些null的JSON元素。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/itguangit/article/details/78701110">CSDN:jackSon注解– @JsonInclude 注解不返回null值字段</a></p>
</blockquote>
<p>MyBatis Plus QueryWrapper查询方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">   QueryWrapper queryWrapper= <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Posts&gt;().select(<span class="string">&quot;title&quot;</span>,<span class="string">&quot;post_medium_image&quot;</span>,<span class="string">&quot;date&quot;</span>,<span class="string">&quot;total_comments&quot;</span>,<span class="string">&quot;like_count&quot;</span>,<span class="string">&quot;pageviews&quot;</span>).orderByDesc(<span class="string">&quot;date&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//只查询&quot;title&quot;,&quot;post_medium_image&quot;,&quot;date&quot;,&quot;total_comments&quot;,&quot;like_count&quot;,&quot;pageviews&quot;些字段</span></span><br></pre></td></tr></table></figure>



<p>未去除空元素，调用对应的后端接口：</p>
<p><img src="/images/java_dev/image-20220316100359022.png" alt="查询的带有null元素的JSON"></p>
<p><strong>解决方法：</strong></p>
<ul>
<li><p>在对应的实体类上加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br></pre></td></tr></table></figure>

<p>加此注解后，查询的此实体类显示对应的JSON就会不显示值为null的元素，不加注释的实体类依旧是上面的不去除null元素的状态。</p>
</li>
<li><p>在Spring Boot 配置文件<code>application.yml</code>配置使全局生效</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/school_wall?useUnicode=true&amp;useSSL=false&amp;character_set_server</span> <span class="string">=</span> <span class="string">utf8mb4</span> <span class="string">&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">fuding</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">******</span></span><br><span class="line">  <span class="attr">jackson:</span></span><br><span class="line">    <span class="attr">default-property-inclusion:</span> <span class="string">non_null</span> <span class="comment"># 全局jackson配置</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样配置后所有实体类对应的JOSN查询结果只要是null元素就会不显示。</p>
</li>
</ul>
<p><strong>去除空元素的显示效果</strong>：</p>
<p><img src="/images/java_dev/image-20220316102221001.png" alt="去除null元素"></p>
<h3 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--简化实体类代码工具lombok--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h3 id="MariaDB"><a href="#MariaDB" class="headerlink" title="MariaDB"></a>MariaDB</h3><blockquote>
<p>MariaDB and MySQL are two of the most widely deployed open source relational databases in the world and, while they share a common ancestry and maintain compatibility via the MySQL protocol (MySQL clients can connect to MariaDB and vice versa), they have evolved in their own ways, becoming separate databases with unique features and different product visions. Organizations of all sizes continue to replace MySQL with MariaDB in order to take advantage of the innovation in MariaDB – and to get out from under Oracle.</p>
<p>MariaDB和MySQL是世界上部署最广泛的两个开源关系数据库，虽然它们共享一个共同的祖先，并通过MySQL协议保持兼容性(MySQL客户端可以连接到MariaDB，反之亦然)，但它们以自己的方式发展，成为具有独特功能和不同产品愿景的独立数据库。为了充分利用MariaDB的创新，摆脱Oracle的统治，各种规模的组织都在继续用MariaDB取代MySQL。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://mariadb.com/kb/en/java-connector-using-maven/">官网使用Maven配置MariaDB</a></p>
<p><a target="_blank" rel="noopener" href="https://mariadb.com/database-topics/mariadb-vs-mysql/">MariaDB对比MySQL</a></p>
</blockquote>
<p><strong>替换掉之前使用的MySQL Java Connector（JDBC）：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        &lt;dependency&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;groupId&gt;mysql&lt;/groupId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;scope&gt;runtime&lt;/scope&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/dependency&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mariadb.jdbc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mariadb-java-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>开发过程中选用的是最新版MariaDB:</strong> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">arch</span> ॐ  ~:</span><br><span class="line">2015 ◯  mysql -V    </span><br><span class="line">mysql  Ver 15.1 Distrib 10.7.3-MariaDB, <span class="keyword">for</span> Linux (x86_64) using readline 5.1</span><br></pre></td></tr></table></figure>



<p><strong>允许Mysql用户外部访问:</strong></p>
<ol>
<li><p>登进MySQL之后。</p>
</li>
<li><p>输入以下语句，进入mysql库：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use mysql</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新域属性，’%’表示允许外部访问：</p>
<blockquote>
<p>注意MariaDB最新版本，“%”不代表本地主机可登录。</p>
</blockquote>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> host<span class="operator">=</span><span class="string">&#x27;%&#x27;</span> <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span><span class="string">&#x27;root&#x27;</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行以上语句之后再执行：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="MyBatis-Plus"><a href="#MyBatis-Plus" class="headerlink" title="MyBatis-Plus"></a>MyBatis-Plus</h3><blockquote>
<ul>
<li>润物无声只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑。</li>
<li>效率至上只需简单配置，即可快速进行单表 CRUD 操作，从而节省大量时间。</li>
<li>丰富功能代码生成、自动分页、逻辑删除、自动填充等功能一应俱全。</li>
</ul>
<p>缺点当然也有的，这个框架只提供了不用手写SQL不再使用手写xml的单表操作，但多表操作还是要使用MyBatis进行手写多表操作的SQL，然后写对应的xml文件。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/pages/24112f/">MyBatis-Plus 官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus">GitHub:baomidou&#x2F;mybatis-plus</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/baomidou/generator">GitHub：Mybatis Plus代码生成器</a></p>
<p><a target="_blank" rel="noopener" href="http://freemarker.foofun.cn/">freemarker（代码生成器依赖）</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.51cto.com/u_15103026/2645265">51CTO博客：100%解决 java.sql.SQLException: Unsupported character encoding ‘utf8mb4’.</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/A_Java_Dog/article/details/108147114">mybatis-plus自动生成实体类(包含swagger注解)</a></p>
</blockquote>
<h4 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h4><p><strong>首先导入以下Jar包：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--MyBatis plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-freemarker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--MyBatis plus代码生成器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>pom中导入mybatis plus的jar包，因为后面会涉及到代码生成器，所以我们还需要导入页面模板引擎，这里我用的是freemarker。</p>
<p>MyBatis Plus需要连接数据库所需配置文件：</p>
<p>&#x2F;schoolwall&#x2F;src&#x2F;main&#x2F;resources&#x2F;application.yml（此处默认是properties格式，后缀改过来）</p>
<p>使用.yml更方便，且Spring Boot默认也支持这种格式。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#DataSource Config</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/school_wall?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8mb4&amp;serverTimezone=Asia/Shanghai</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">admin</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**Mapper.xml</span>  <span class="comment"># 此处是实现Mapper接口类的配置文件（相当于Mapper接口的实现类），一般位于</span></span><br></pre></td></tr></table></figure>

<p><strong>开启mapper接口扫描，添加分页插件：</strong></p>
<p>新建一个包：通过<a target="_blank" rel="noopener" href="https://github.com/mapperScan">@mapperScan</a>注解指定要变成实现类的接口所在的包，然后包下面的所有接口在编译之后都会生成相应的实现类。PaginationInterceptor是一个分页插件。</p>
<ul>
<li>com.schoolwall.config.MybatisPlusConfig.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span> <span class="comment">//相当于传统的xml配置文</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span>  <span class="comment">//</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.schoolwall.mapper&quot;)</span>	<span class="comment">//此处扫描的是Mapper接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PaginationInterceptor <span class="title function_">paginationInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">PaginationInterceptor</span> <span class="variable">paginationInterceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PaginationInterceptor</span>();</span><br><span class="line">        <span class="keyword">return</span> paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据库字符集设置成utf8mb4，代码生成器，报错：</strong></p>
<p>报错如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.sql.SQLException: Unsupported character encoding &#x27;utf8mb4&#x27;</span><br></pre></td></tr></table></figure>

<p>改掉数据库链接配置（生成器）这块：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据源配置</span></span><br><span class="line">        <span class="type">DataSourceConfig</span> <span class="variable">dsc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceConfig</span>();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/school_wall?useUnicode=true&amp;useSSL=false&amp;character_set_server=utf8mb4 &amp;serverTimezone=Asia/Shanghai&quot;</span>);</span><br><span class="line">        <span class="comment">// dsc.setSchemaName(&quot;public&quot;);</span></span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br></pre></td></tr></table></figure>

<ul>
<li>将原本老的数据集utf8，<code>characterEncoding = utf8</code>；</li>
<li>改为新版数据集utf8mb4，<code>character_set_server  =utf8mb4 </code>；</li>
</ul>
<h4 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h4><p><strong>执行自动生成 Mapper、Service、Controller：</strong></p>
<p><img src="/images/java_dev/mp_general.png" alt="执行生成器代码"></p>
<p><strong>但是在开发过程中遇到了一个非常令人困惑的问题：</strong></p>
<p>查询数据库表数据是没有任何问题的：</p>
<p><img src="/images/java_dev/image-20220311153139140.png" alt="相关数据库表数据"></p>
<p>但是用Java写的查询数据，生成Json就会出现某些字段为空的情况，调用了接口<code>http://0.0.0.0:3000/schoolwall/posts/page=1</code>：</p>
<p><img src="/images/java_dev/image-20220311155909653.png" alt="服务器响应JSON代码"></p>
<p>盯着代码观察好一会儿，最后发现原来只有带<code>_</code>的字段出现了相同的问题，看来是之前配置的MyBatis Plus 代码生成器的配置问题导致生成的实体类不使用驼峰命名法，而是全使用了<code>_</code>进行了命名。</p>
<ul>
<li><p>旧生成器配置代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strategy.setNaming(NamingStrategy.no_change);		<span class="comment">//原表名不更改</span></span><br><span class="line">strategy.setColumnNaming(NamingStrategy.no_change);		<span class="comment">//原字段名不更改</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>新生成器配置代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">strategy.setNaming(NamingStrategy.underline_to_camel);		<span class="comment">//这俩都要进行更改</span></span><br><span class="line">strategy.setColumnNaming(NamingStrategy.underline_to_camel);		</span><br></pre></td></tr></table></figure></li>
</ul>
<p>但由于代码生成器已经生成代码，再进行生成同一个表名的话可能会出现代码覆盖的情况，谨慎的我还是自己修改了实体类的变量，将实体类的变量下划线命名法全改为驼峰命名法，解决了这个迷一样的问题：</p>
<p><img src="/images/java_dev/image-20220311162151186.png" alt="访问API查看"></p>
<p>回到小程序开发工具点击编译查看列表情况：</p>
<p><img src="/images/java_dev/mini_app1.jpg"></p>
<p><strong>代码生成器特性：</strong></p>
<ul>
<li><p>已经生成的数据库表代码，再次生成不会覆盖之前生成的代码。</p>
<p><img src="/images/java_dev/image-20220314204601573.png" alt="代码生成器再次生成同一张表"></p>
<p>显然没有之前生成一个新表那么多的代码了，且没有更改任何之前生成的代码和自己写的PostsController。</p>
</li>
<li><p>生成的代码比如生成的entity代码，自己是可以进行更改的。</p>
<p>比如数据库表的字段进行删除或者添加字段，我们可进行手动进行添加或者删除entity内部变量，并且遵循自己代码生成器的规则。</p>
</li>
<li><p>数据库内部可以多几个字段可以不添加到entity内，但entity里的参数数据库字段必须有，不然查询就会失败等，虽然可以运行项目。</p>
<p>如果需要添加属性但数据库不存在的字段解决方式，在相应的实体类属性添加注解，不加会报错：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableField(exist = false)</span>		<span class="comment">//表示忽略这个映射到数据库，自定义的属性，但后面的代码要赋值于此又不得不用上</span></span><br><span class="line"><span class="keyword">private</span> List postAllImages;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="分页插件"><a href="#分页插件" class="headerlink" title="分页插件"></a>分页插件</h4><blockquote>
<p>分页插件的使用是需要进行配置的，推荐使用Spring Boot方式进行分页插件的配置，配置详情请查看以下帖子。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38111957/article/details/91554108">CSDN:MyBatis-Plus 分页查询以及自定义sql分页</a></p>
<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7005191804710551565#heading-6">配置Mybatis-plus分页插件，返回统一结果集</a></p>
</blockquote>
<p><strong>分页的实现原理：</strong></p>
<p>Mybatis-plus分页插件使用的是IPage进行分页。IPage内部原理是基于拦截器，拦截的<strong>是方法以及方法中的参数</strong>。判断<strong>是否是查询操作</strong>，如果是查询操作，才会进入分页的处理逻辑。 进入分页逻辑处理后，拦截器会通过反射获取该方法的参数进行判断<strong>是否存在IPage对象的实现类</strong>。如果不存在则不进行分页，存在则将该参数赋值给IPage对象，然后进行拼接sql的处理完成分页操作。</p>
<ul>
<li><p>物理分页：相当于执行了limit分页语句，返回部分数据。物理分页只返回部分数据占用内存小，能够获取数据库最新的状态，实施性比较强，一般适用于数据量比较大，数据更新比较频繁的场景。</p>
</li>
<li><p>逻辑分页：一次性把全部的数据取出来，通过程序进行筛选数据。如果数据量大的情况下会消耗大量的内存，由于逻辑分页只需要读取数据库一次，不能获取数据库最新状态，实施性比较差，适用于数据量小，数据稳定的场</p>
</li>
</ul>
<p>代码中单表查询分页的一个例子，以下是讲一个表进行了按照时间进行排序后，再进过MyBatis Plus分页插件方便进行每5个条目为一页的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> IPage <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable(name = &quot;page&quot;)</span> Integer page)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Page</span> <span class="variable">dividePage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, <span class="number">10</span>,<span class="literal">false</span>);     <span class="comment">//false 代表不进行全部列表的条目统计，即只进行了数据库内部进行分页操作，如果不定义就会查询所有条目并统计所有条目数目，于是我们有需求只要查询数据即可， 不关心总记录数等，如果使用默认的方式就消耗不必要的性能。那么解决办法也是很简单的，只需要在创建page对象时传入第三个参数为false即可。</span></span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Posts&gt;().select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;title&quot;</span>, <span class="string">&quot;post_medium_image&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;total_comments&quot;</span>, <span class="string">&quot;like_count&quot;</span>, <span class="string">&quot;pageviews&quot;</span>).orderByDesc(<span class="string">&quot;date&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">IPage</span> <span class="variable">pageData</span> <span class="operator">=</span> postsService.page(dividePage, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageData;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>不加false查询结果：</p>
<p><img src="/images/java_dev/image-20220323175203253.png" alt="image-20220323175203253"></p>
</li>
<li><p>加上false查询结果：</p>
<p><img src="/images/java_dev/image-20220323175307585.png" alt="image-20220323175307585"></p>
</li>
</ul>
<h4 id="10篇帖子为1页，分页获取列表-1"><a href="#10篇帖子为1页，分页获取列表-1" class="headerlink" title="10篇帖子为1页，分页获取列表"></a>10篇帖子为1页，分页获取列表</h4><blockquote>
<p>参阅以下内容请先参阅：</p>
<ol>
<li>API规划 &gt; 小程序首页 &gt; 10篇帖子为1页，分页获取列表</li>
<li>数据库设计 &gt; 数据分析 &gt; 10篇帖子为1页，分页获取列表</li>
<li></li>
</ol>
<p>由于是单表查询操作，开箱即用不用写Mapper直接调用MyBatis Plus内部分页插件方法即可。</p>
</blockquote>
<p>PostsController：</p>
<p>和评论列表一样调用分页<code>new Page(page, 10,false)取消</code>配置了计数全部数据的功能，即使用MySQL提供的物理翻页，好处就是节省服务器性能和节省内存，这个模块也是插入修改数据相当频繁的，没必要使用逻辑翻页，不懂请查阅 <code>后端开发 &gt; MyBatis-Plus &gt; 分页插件</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/schoolwall&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PostsController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PostsService postsService;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//查询帖子分页列表</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/posts/page=&#123;page&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> IPage <span class="title function_">list</span><span class="params">(<span class="meta">@PathVariable(name = &quot;page&quot;)</span> Integer page)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Page</span> <span class="variable">dividePage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(page, <span class="number">10</span>,<span class="literal">false</span>);     <span class="comment">//false 代表不进行全部列表的条目统计，即只进行了数据库内部进行分页操作，如果不定义就会查询所有条目并统计所有条目数目</span></span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Posts&gt;().select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;title&quot;</span>, <span class="string">&quot;post_medium_image&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;total_comments&quot;</span>, <span class="string">&quot;like_count&quot;</span>, <span class="string">&quot;pageviews&quot;</span>).orderByDesc(<span class="string">&quot;date&quot;</span>);</span><br><span class="line">        <span class="comment">//QueryWrapper&lt;Blog&gt;查询出来后应该是全部的Blog列表然后进行一个排序，利用page进行分页操作。</span></span><br><span class="line">        <span class="type">IPage</span> <span class="variable">pageData</span> <span class="operator">=</span> postsService.page(dividePage, queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageData;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>调用后端接口<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=%7B%7D%EF%BC%9A">http://0.0.0.0:3000/schoolwall/posts/page={}：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">123</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-16T16:33:06&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://img2.baidu.com/it/u=3530793501,2812976182&amp;fm=253&amp;fmt=auto&amp;app=120&amp;f=JPEG?w=889&amp;h=500&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">222</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">2222</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">122</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">121</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;找到对象了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/kids.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">999</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">119</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">118</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">117</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;找到对象了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/kids.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">999</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">116</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">115</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">114</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;找到对象了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">99</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/kids.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">999</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">9999</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="根据分类ID获取某个分类信息-1"><a href="#根据分类ID获取某个分类信息-1" class="headerlink" title="根据分类ID获取某个分类信息"></a>根据分类ID获取某个分类信息</h4><blockquote>
<p>实现这个依旧是单表查询操作，MyBatis Plus 直接几句即可搞定。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PostCategoriesService postCategoriesService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据ID获取某个分类信息</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;getcategorie/id=&#123;cid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> PostCategories <span class="title function_">getCategorById</span><span class="params">(<span class="meta">@PathVariable(name = &quot;cid&quot;)</span> Integer cid)</span>&#123;</span><br><span class="line"></span><br><span class="line">        PostCategories postCategories= postCategoriesService.getById(cid);		<span class="comment">//直接调用通过主键ID查询一条数据即可</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> postCategories;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h4 id="根据分类ID获取所有该ID下的帖子并翻页-1"><a href="#根据分类ID获取所有该ID下的帖子并翻页-1" class="headerlink" title="根据分类ID获取所有该ID下的帖子并翻页"></a>根据分类ID获取所有该ID下的帖子并翻页</h4><blockquote>
<p> 帖子表其中的分类表格的ID还是有的，等于说分类表为帖子表的主表，从表的数据直接可以利用其外键字段查出所有某一分类下的所有帖子。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">		<span class="meta">@Autowired</span></span><br><span class="line">    PostsService postsService;</span><br><span class="line"><span class="comment">//根据分类ID获取该ID下的所有文章</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/posts/page=&#123;page&#125;/categorieid=&#123;cid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;Posts&gt; <span class="title function_">postListByCategorieId</span><span class="params">(<span class="meta">@PathVariable(name = &quot;page&quot;)</span> Integer pageNum ,<span class="meta">@PathVariable(name = &quot;cid&quot;)</span> Integer cateId)</span>&#123;</span><br><span class="line"></span><br><span class="line">        QueryWrapper queryWrapper= <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Posts&gt;().select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;title&quot;</span>, <span class="string">&quot;post_medium_image&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;total_comments&quot;</span>, <span class="string">&quot;like_count&quot;</span>, <span class="string">&quot;pageviews&quot;</span>).eq(<span class="string">&quot;category_id&quot;</span>,cateId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">Page</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(pageNum,<span class="number">10</span>,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        IPage&lt;Posts&gt; pageData = postsService.page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> pageData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>调用后端接口：</p>
<p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=1/categorieid=3">http://0.0.0.0:3000/schoolwall/posts/page=1/categorieid=3</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-10T19:55:41&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">135</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:05&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">103</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:05&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">104</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">106</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">107</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">109</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">110</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">112</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">115</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>调用后端接口<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=2/categorieid=3%EF%BC%9A">http://0.0.0.0:3000/schoolwall/posts/page=2/categorieid=3：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">116</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">118</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">119</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">121</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="搜索文章或标题功能的实现-1"><a href="#搜索文章或标题功能的实现-1" class="headerlink" title="搜索文章或标题功能的实现"></a>搜索文章或标题功能的实现</h4><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://baomidou.com/pages/10c804/#abstractwrapper">MyBatis Plus官网：条件构造器</a></p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-encodeuricomponent.html">菜鸟教程：encodeURIComponent()</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jb51.net/article/131002.htm">脚本之家：Java实现代码搜索功能详解</a></p>
</blockquote>
<p>主要还是通过数据库的关键字查找两个字段就可以实现，MyBatis Plus 实现同样的功能就相当于下面的SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id, title, post_medium_image, <span class="type">date</span>, total_comments, like_count, pageviews</span><br><span class="line"><span class="keyword">FROM</span> school_wall.sw_posts</span><br><span class="line"><span class="keyword">where</span> content <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span>		#concat() 连接字符串的作用</span><br><span class="line">    , #&#123;searchKey&#125;</span><br><span class="line">    , <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line">   <span class="keyword">or</span> title <span class="keyword">like</span> concat(<span class="string">&#x27;%&#x27;</span></span><br><span class="line">    , #&#123;searchKey&#125;</span><br><span class="line">    , <span class="string">&#x27;%&#x27;</span>)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="type">date</span> <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">PostsService postsService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据关键字搜索含有关键字的标题或文章</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/posts/page=&#123;pagenum&#125;/search=&#123;keyword&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;Posts&gt; <span class="title function_">searchPosts</span><span class="params">(<span class="meta">@PathVariable(&quot;pagenum&quot;)</span> Integer pageNum,<span class="meta">@PathVariable(&quot;keyword&quot;)</span> String keyWord)</span> &#123;</span><br><span class="line">        <span class="type">QueryWrapper</span> <span class="variable">queryWrapper</span> <span class="operator">=</span><span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Posts&gt;()</span><br><span class="line">                .select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;title&quot;</span>, <span class="string">&quot;post_medium_image&quot;</span>, <span class="string">&quot;date&quot;</span>, <span class="string">&quot;total_comments&quot;</span>, <span class="string">&quot;like_count&quot;</span>, <span class="string">&quot;pageviews&quot;</span>)</span><br><span class="line">                .like(<span class="string">&quot;content&quot;</span>,keyWord)</span><br><span class="line">                .or()</span><br><span class="line">                .like(<span class="string">&quot;title&quot;</span>,keyWord);</span><br><span class="line"></span><br><span class="line">        <span class="type">Page</span> <span class="variable">page</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Page</span>(pageNum, <span class="number">10</span>,<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        IPage&lt;Posts&gt; searchPostsPage= postsService.page(page,queryWrapper);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(&quot;当前页面：&quot;+ pageNum+&quot;-------------搜索关键字：&quot;+keyWord);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> searchPostsPage;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p>调用后端接口：</p>
<p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=2/search=%E4%BC%9E%EF%BC%88%E4%BC%9E%EF%BC%89,%E5%89%8D%E7%AB%AF%E5%BE%80search%E4%BC%A0%E5%80%BC%E7%9A%84%E6%97%B6%E5%80%99%E5%81%9A%E4%BA%86%60encodeURIComponent()%60%E5%AF%B9%E5%85%B3%E9%94%AE%E5%AD%97%E8%BF%9B%E8%A1%8C%E4%BA%86%E5%A4%84%E7%90%86%EF%BC%8C%E4%BB%A5%E5%85%8D%E5%87%BA%E7%8E%B0%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E7%9A%84%E6%83%85%E5%86%B5">http://0.0.0.0:3000/schoolwall/posts/page=2/search=%E4%BC%9E（伞）,前端往search传值的时候做了`encodeURIComponent()`对关键字进行了处理，以免出现不能访问的情况</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-10T19:55:41&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">23</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">56</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">135</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">101</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:05&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">103</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:05&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">104</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">106</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:45:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">107</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">109</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">110</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">112</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">115</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/posts/page=2/search=%E4%BC%9E%EF%BC%88%E4%BC%9E%EF%BC%89">http://0.0.0.0:3000/schoolwall/posts/page=2/search=%E4%BC%9E（伞）</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">116</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">118</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">119</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">121</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/images/error.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">111</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">1111</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">122</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-12T10:46:18&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;伞丢了&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;totalComments&quot;</span><span class="punctuation">:</span> <span class="number">16</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;postMediumImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/posts/dog.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;likeCount&quot;</span><span class="punctuation">:</span> <span class="number">22</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">223</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h3><blockquote>
<p>参阅以下内容请先参阅：</p>
<ol>
<li>后端开发 &gt; MyBatis-Plus &gt; 分页插件</li>
<li>API规划 &gt; 小程序首页 &gt; 根据帖子ID获取评论列表</li>
<li>数据库设计 &gt; 数据分析 &gt; 评论列表</li>
</ol>
<p>MyBatis Plus 开始的介绍已经提到，MyBatis Plus 不支持对多表查询的优化，由于MyBatis Plus是基于MyBatis进行开发的，所以之前的MyBatis的东西该有的还是有的，直接使用MyBatis自身有的老方式进行多表查询操作，这个模块将进行MyBatis Plus的分页插件进行一个分页操作。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html#">MyBatis官网： XML 映射文件配置</a></p>
<p><a target="_blank" rel="noopener" href="https://www.yht7.com/news/158685">云海天教：详解MyBatis resultType与resultMap中的几种返回类型</a></p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/346009753">知乎：mybatisplus比mybatis到底好在哪里?</a></p>
</blockquote>
<p>使用的MyBatis 其中配置了代码生成器直接就可以编辑Mapper文件，写MyBatis 的xml配置，不用手动或者依靠IDEA手动操作生成，开箱即用。</p>
<h4 id="帖子分类列表"><a href="#帖子分类列表" class="headerlink" title="帖子分类列表"></a>帖子分类列表</h4><p>Mapper配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;postCategoriesMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.schoolwall.entity.PostCategories&quot;</span> <span class="attr">autoMapping</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;count&quot;</span> <span class="attr">column</span>=<span class="string">&quot;posts_count&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCountPostByCategories&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;postCategoriesMap&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    select spc.id, spc.name, spc.description, spc.category_thumbnail_image, count(sp.id) as posts_count</span><br><span class="line">    from sw_post_categories spc</span><br><span class="line">             left join sw_posts sp on sp.category_id = spc.id</span><br><span class="line">    group by spc.id</span><br><span class="line">    order by posts_count desc</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>Mapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(value = &quot;PostCategoriesMapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PostCategoriesMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;PostCategories&gt; &#123;</span><br><span class="line">    List&lt;PostCategories&gt; <span class="title function_">selectCountPostByCategories</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Service接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PostCategoriesService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;PostCategories&gt; &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;PostCategories&gt; <span class="title function_">selectCountPostByCategories</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>ServiceImp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PostCategoriesServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;PostCategoriesMapper, PostCategories&gt; <span class="keyword">implements</span> <span class="title class_">PostCategoriesService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    PostCategoriesMapper postCategoriesMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;PostCategories&gt; <span class="title function_">selectCountPostByCategories</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;PostCategories&gt; categorisesConutList = postCategoriesMapper.selectCountPostByCategories();</span><br><span class="line">        <span class="keyword">return</span> categorisesConutList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>实现后调用帖子分类计数的接口：  <a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/categories%EF%BC%9A">http://0.0.0.0:3000/schoolwall/categories：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;寻物&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/category/losejpeg.jpeg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">14</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;校园生活&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;爱校园，爱生活~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/category/schoollife.jpeg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">9</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;二手交易&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/category/used.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;表白&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你眨一下眼，就翻阅了我心里的春夏秋冬。&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/category/love.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;建议&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;捞人&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://gitee.com/ding-f/school_wall_imgs/raw/master/category/look_for.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;交友&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;学习&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;推广&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;失物招领&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;没有描述~&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;categoryThumbnailImage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="Bilibili评论列表"><a href="#Bilibili评论列表" class="headerlink" title="Bilibili评论列表"></a>Bilibili评论列表</h4><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_38111957/article/details/91554108">CSDN:MyBatis-Plus 分页查询以及自定义sql分页</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/ruananqing/article/details/83099180">CSDN：Spring Boot：关于“No converter found for return value of type: class xxx”的解决方法</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_42740530/article/details/88180635">CSDN：Expected one result (or null) to be returned by selectOne(), but found: 3</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37156367/article/details/107953248">CSDN：使用Mybatis-Plus时，注入mapper提示Could not autowire. No beans of ‘xxxMapper‘ type found.</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Mrqiang9001/article/details/79520436">关于Mybatis的@Param注解</a></p>
</blockquote>
<p>Bilibili评论列表的Mapper配置：</p>
<p>下面的配置文件手动进行了映射操作，当然可以进行自动映射的，模仿大佬，提升一下性能，不使用自动映射，把每个字段都进行一个手动配置，说真的挺累的，报了两次类型不匹配的异常才把手动映射试成功。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.schoolwall.mapper.FatherReplyMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;replyVoResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.schoolwall.entity.vo.ReplyVo&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;f_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;f_nick_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;nickName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;f_avatar_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;avatarUrl&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;f_content&quot;</span> <span class="attr">property</span>=<span class="string">&quot;content&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;LONGVARCHAR&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;f_father_reply_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fatherReplyDate&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;sonList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.schoolwall.entity.vo.SonReplyVo&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;s_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;BIGINT&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;s_nick_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;nickName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;s_avatar_url&quot;</span> <span class="attr">property</span>=<span class="string">&quot;avatarUrl&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;s_content&quot;</span> <span class="attr">property</span>=<span class="string">&quot;content&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;LONGVARCHAR&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;s_receiver_nick&quot;</span> <span class="attr">property</span>=<span class="string">&quot;receiverNick&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;CHAR&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;s_son_reply_date&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sonReplyDate&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;TIMESTAMP&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectReplyVoByPostId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;replyVoResultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">        select f.id as f_id,u.nick_name as f_nick_name,u.avatar_url as f_avatar_url,f.content as</span><br><span class="line">        f_content,f.father_reply_date as f_father_reply_date,</span><br><span class="line"></span><br><span class="line">        s.id as s_id,su.nick_name as s_nick_name,su.avatar_url as</span><br><span class="line">        s_avatar_url,s.content as s_content,s.receiver_nick as s_receiver_nick,s.son_reply_date as s_son_reply_date</span><br><span class="line">        from sw_father_reply f</span><br><span class="line">        left join sw_user u on user_id = u.id</span><br><span class="line">        left join sw_son_reply s on father_reply_id = f.id</span><br><span class="line">        left join sw_user su on su.id = s.user_id</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            f.post_id = #&#123;post_id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by father_reply_date asc, son_reply_date asc</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Mapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Component(value = &quot;FatherReplyMapper&quot;)</span>		<span class="comment">// 由于IDEA如果不配置这个就会报红</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FatherReplyMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;FatherReply&gt; &#123;</span><br><span class="line"></span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectReplyVoByPostId</span><span class="params">(IPage&lt;Map&lt;String, Object&gt;&gt; page,<span class="meta">@Param(&quot;post_id&quot;)</span> Long postID)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Service接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FatherReplyService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;FatherReply&gt; &#123;</span><br><span class="line">    IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectReplyVoByPostId</span><span class="params">(IPage&lt;Map&lt;String, Object&gt;&gt; page,<span class="meta">@Param(&quot;post_id&quot;)</span> Long postId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>仔细的读者会发现其中的@Param注解，此注解一定是标注在接口上的，作用是将查询数据映射到数据库字段的，其中@Param注解中含有字符串<code>post_id</code>就是数据表字段名。</li>
</ul>
<p>ServiceImp：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FatherReplyServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;FatherReplyMapper, FatherReply&gt; <span class="keyword">implements</span> <span class="title class_">FatherReplyService</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> FatherReplyMapper fatherReplyMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> IPage&lt;Map&lt;String, Object&gt;&gt; <span class="title function_">selectReplyVoByPostId</span><span class="params">(IPage&lt;Map&lt;String, Object&gt;&gt; page, Long postId)</span> &#123;</span><br><span class="line">        IPage&lt;Map&lt;String, Object&gt;&gt; iPageFatherReply= fatherReplyMapper.selectReplyVoByPostId(page,postId);</span><br><span class="line">        <span class="keyword">return</span> iPageFatherReply;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上的注意观察会发现返回类型和一般情况下有所不同，原因是使用了MyBatis Plus的分页插件，MyBatis Plus的分页插件可以作用于未做增强的MyBatis之上的。</p>
<p>调用接口没有问题的话就是这样的结果：</p>
<p>调用后端接口：</p>
<p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=1">http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=1</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://syimg.3dmgame.com/uploadimg/xiaz/2021/0803/1627959355632.gif&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瓜多少钱一斤啊&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fatherReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-16T20:35:12&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sonList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.5一斤。&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:37:41&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://syimg.3dmgame.com/uploadimg/xiaz/2021/0803/1627959355632.gif&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;皮瓜金子做的还是瓜粒子金子做的？   看，吸铁石，另外你说的瓜要是生的你自己吞进去？！&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:38:54&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是故意找茬儿是不是？？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:39:39&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是哪位？？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fatherReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-17T20:22:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sonList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是你**。&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:30:59&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;出来单挑啊？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:32:10&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=2">http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=2</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;code&quot;: <span class="number">200</span>,</span><br><span class="line">    &quot;msg&quot;: &quot;操作成功&quot;,</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;records&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;id&quot;: <span class="number">1</span>,</span><br><span class="line">                &quot;nickName&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                &quot;avatarUrl&quot;: &quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;,</span><br><span class="line">                &quot;content&quot;: &quot;你是哪位？？&quot;,</span><br><span class="line">                &quot;fatherReplyDate&quot;: &quot;2022-03-17T20:22:42&quot;,</span><br><span class="line">                &quot;sonList&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: <span class="number">3</span>,</span><br><span class="line">                        &quot;nickName&quot;: &quot;水果摊摊主&quot;,</span><br><span class="line">                        &quot;avatarUrl&quot;: &quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;单挑啊&quot;,</span><br><span class="line">                        &quot;receiverNick&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                        &quot;sonReplyDate&quot;: &quot;2022-03-20T19:33:11&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: <span class="number">4</span>,</span><br><span class="line">                        &quot;nickName&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                        &quot;avatarUrl&quot;: &quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;来啊&quot;,</span><br><span class="line">                        &quot;receiverNick&quot;: &quot;水果摊摊主&quot;,</span><br><span class="line">                        &quot;sonReplyDate&quot;: &quot;2022-03-20T19:34:16&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: <span class="number">5</span>,</span><br><span class="line">                        &quot;nickName&quot;: &quot;水果摊摊主&quot;,</span><br><span class="line">                        &quot;avatarUrl&quot;: &quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;你打我&quot;,</span><br><span class="line">                        &quot;receiverNick&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                        &quot;sonReplyDate&quot;: &quot;2022-03-20T19:34:51&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: <span class="number">6</span>,</span><br><span class="line">                        &quot;nickName&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                        &quot;avatarUrl&quot;: &quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;我打你，你打我又怎样？&quot;,</span><br><span class="line">                        &quot;receiverNick&quot;: &quot;水果摊摊主&quot;,</span><br><span class="line">                        &quot;sonReplyDate&quot;: &quot;2022-03-20T19:35:35&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;id&quot;: <span class="number">7</span>,</span><br><span class="line">                        &quot;nickName&quot;: &quot;水果摊摊主&quot;,</span><br><span class="line">                        &quot;avatarUrl&quot;: &quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;,</span><br><span class="line">                        &quot;content&quot;: &quot;你有没有砍过人&quot;,</span><br><span class="line">                        &quot;receiverNick&quot;: &quot;铸鼎_&quot;,</span><br><span class="line">                        &quot;sonReplyDate&quot;: &quot;2022-03-20T19:36:24&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;total&quot;: <span class="number">0</span>,</span><br><span class="line">        &quot;size&quot;: <span class="number">5</span>,</span><br><span class="line">        &quot;current&quot;: <span class="number">2</span>,</span><br><span class="line">        &quot;orders&quot;: [],</span><br><span class="line">        &quot;searchCount&quot;: <span class="literal">false</span>,</span><br><span class="line">        &quot;pages&quot;: <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Shiro-Redis-JWT"><a href="#Shiro-Redis-JWT" class="headerlink" title="Shiro Redis +JWT"></a>Shiro Redis +JWT</h3><blockquote>
<p> JSON Web Token（缩写 JWT）是目前最流行的跨域认证解决方案，本节介绍它的原理和用法。</p>
<p> 需要做的是前后端分离项目的骨架，所以一般我们会采用jwt作为跨域身份验证解决方案。所以整合shiro的过 程中，我们需要引入jwt的身份验证过程。</p>
<p> 请教前端大佬，小程序APP都要解决跨域问题，于是查询资料上说明要解决跨域问题还是要整合JWT登录实现JSON Web Token作为SessionID代替Session方式进行验证用户身份等问题。</p>
<p> 参考：</p>
<p> <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/de544b13b9d5">springboot热部署之spring-boot-devtools</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/alexxiyang/shiro-redis/issues/82">GitHub：pring-boot-devtools+shiro-redis集成的一个错误</a></p>
<p> <a target="_blank" rel="noopener" href="http://blog.zollty.com/b/archive/integrating-shiro-session-and-jwt-login.html">整合Shiro Session和JWT登录</a></p>
<p> <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/339477329">知乎：Base64编码详解</a></p>
<p> <a target="_blank" rel="noopener" href="https://github.com/jwtk/jjwt">GitHub：jjwt</a></p>
</blockquote>
<h4 id="JWT-原理"><a href="#JWT-原理" class="headerlink" title="JWT 原理"></a>JWT 原理</h4><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/576dbf44b2ae">简书：什么是 JWT – JSON WEB TOKEN</a></p>
<p><a target="_blank" rel="noopener" href="https://restfulapi.cn/page/jwt">RESTful API:JWT 认证</a></p>
<p><a target="_blank" rel="noopener" href="https://jwt.io/">JWT官网</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/sdnyqfyqf/article/details/105534376">CSDN:从零入门HMAC-SHA256</a></p>
</blockquote>
<p>服务器认证以后，生成一个 JSON 对象，发回给用户，就像下面这样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> &quot;姓名&quot;: &quot;张三&quot;,</span><br><span class="line"> &quot;角色&quot;: &quot;管理员&quot;,</span><br><span class="line"> &quot;到期时间&quot;: &quot;2018年7月1日0点0分&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>以后，用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候，会加上签名（详见后文）。</p>
<p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>
<p><strong>JWT 的数据结构</strong>：</p>
<p>实际的 JWT 大概就像下面这样。</p>
<p><img src="/images/java_dev/jwt_structure.png" alt="img"></p>
<p>它是一个很长的字符串，中间用点（.）分隔成三个部分。注意，JWT 内部是没有换行的，这里只是为了便于展示，将它写成了几行。</p>
<p>JWT 的三个部分依次如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Header（头部）</span><br><span class="line">Payload（负载）</span><br><span class="line">Signature（签名）</span><br></pre></td></tr></table></figure>

<p>写成一行，就是下面的样子。</p>
<p>Header.Payload.Signature</p>
<p><img src="/images/java_dev/jet_structure_all.jpg"></p>
<p>下面依次介绍这三个部分。</p>
<p><strong>Header</strong></p>
<p>Header 部分是一个 JSON 对象，描述 JWT 的元数据，通常是下面的样子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;alg&quot;: &quot;HS256&quot;,</span><br><span class="line">  &quot;typ&quot;: &quot;JWT&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码中，alg属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；typ属性表示这个令牌（token）的类型（type），JWT 令牌统一写为JWT。</p>
<p>最后，将上面的 JSON 对象使用 Base64URL 算法转成字符串。</p>
<p><strong>Payload</strong></p>
<p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">iss (issuer)：签发人</span><br><span class="line">exp (expiration time)：过期时间</span><br><span class="line">sub (subject)：主题</span><br><span class="line">aud (audience)：受众</span><br><span class="line">nbf (Not Before)：生效时间</span><br><span class="line">iat (Issued At)：签发时间</span><br><span class="line">jti (JWT ID)：编号</span><br></pre></td></tr></table></figure>

<p>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;phone&quot;: &quot;1234567890&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;John Doe&quot;,</span><br><span class="line">  &quot;admin&quot;: true</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意，不要把秘密信息放在这个部分。</p>
<p>这个 JSON 对象也要使用 Base64URL 算法转成字符串。</p>
<p><strong>Signature</strong></p>
<p>Signature 部分是对前两部分进行HS256签名，防止数据篡改。</p>
<p>首先，指定一个密钥（secret）。密钥只有服务器知道，不能泄露给用户。然后，使用 Header 里面指定的签名算法（默认是 HMAC SHA256），按照下面的函数产生签名，即需要base64url加密后的header和base64url加密后的payload使用<code>.</code>连接组成的字符串，然后通过header中声明的加密方式进行加盐<code>secret</code>组合加密，就构成了jwt的第三部分Signature。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(base64UrlEncode(header) + &quot;.&quot; + base64UrlEncode(payload), secret)</span><br></pre></td></tr></table></figure>

<p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用”点”（.）分隔，就可以返回给用户。</p>
<p><strong>总结：</strong></p>
<ol>
<li>构建 Header：JWT 的 Header 部分包含了关于生成后的 token 的元数据以及签名算法信息。通常，Header 中包含了两个重要的字段：alg（算法）和 typ（类型）。alg 字段指定了使用的加密算法，例如 HMAC SHA256 或者 RSA。typ 字段指定了 token 的类型，通常为 “JWT”。Header 是一个 JSON 对象，然后将其转换为 Base64 编码字符串。</li>
<li>构建 Payload：Payload 包含了用户的信息或者其他需要传递的数据。Payload 也是一个 JSON 对象，可以包含自定义的字段，也可以包含一些预定义的字段，比如 iss（issuer，签发者）、sub（subject，主题）、exp（expiration time，过期时间）等。Payload 被转换为 Base64 编码字符串。</li>
<li>生成 Signature：Signature 是对 Header 和 Payload 进行签名后得到的字符串。签名算法通常使用 Header 中指定的加密算法，以及使用一个密钥（称为 secret）来生成签名。具体的生成方式取决于所选的算法。通常是将 Header 和 Payload 这两部分通过指定的加密算法生成一个哈希值，然后再使用密钥对哈希值进行加密。最终得到的 Signature 也是一个 Base64 编码字符串。</li>
<li>组装 JWT：将 Base64 编码后的 Header、Payload 和 Signature 用.连接起来，形成最终的 JWT。</li>
</ol>
<p><strong>Base64URL</strong></p>
<p>前面提到，Header 和 Payload 串型化的算法是 Base64URL。这个算法跟 Base64 算法基本类似，但有一些小的不同。</p>
<p>JWT 作为一个令牌（token），有些场合可能会放到 URL（比如 api.example.com&#x2F;?token&#x3D;xxx）。Base64 有三个字符+、&#x2F;和&#x3D;，在 URL 里面有特殊含义，所以要被替换掉：&#x3D;被省略、+替换成-，&#x2F;替换成_ 。这就是 Base64URL 算法。</p>
<p><strong>JWT 的使用方式</strong></p>
<p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以<strong>储存在 localStorage（此项目小程序做法）</strong>。</p>
<p>此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这个方式跨域需要考虑更多问题，所以<strong>更好的做法是放在 HTTP 请求的头信息Authorization字段里面（此项目的做法）</strong>。</p>
<p>Authorization: Bearer</p>
<p>另一种做法是，跨域的时候，JWT 就放在 POST 请求的数据体里面。</p>
<h4 id="JWT替换Session方案"><a href="#JWT替换Session方案" class="headerlink" title="JWT替换Session方案"></a>JWT替换Session方案</h4><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.v2ex.com/t/536256">V2EX：JWT 服务端怎么理解不需要存储 session</a></p>
<p><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/636281">阿里云开发者社区：单点登录（SSO）看这一篇就够了</a></p>
</blockquote>
<p> <strong>JWT分析：</strong></p>
<ul>
<li>JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</li>
<li>JWT 不加密的情况下，不能将秘密数据写入 JWT。</li>
<li>JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</li>
<li>JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</li>
<li>为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</li>
</ul>
<p>JWT 是作为令牌设计的。如果只是入门使用，那么设计的是低级令牌，有这些特点：</p>
<ol>
<li>需要预先申请；</li>
<li>不可伪造，但可复制，可以被冒用；</li>
<li>令牌是唯一认证手段，见牌如见人；</li>
<li>有有效期，但不可收回；</li>
<li>可以负载其它信息，包括授权。低级令牌有这些漏洞：</li>
<li>另外还有一个大漏洞，直接在令牌上放授权，不过一般没人这么干。</li>
</ol>
<p><strong>SessionID与JWT Token 对比：</strong></p>
<table>
<thead>
<tr>
<th>JWT登录步骤</th>
<th>Session登录步骤</th>
</tr>
</thead>
<tbody><tr>
<td>客户端 携带认证名和密码 发起登录请求</td>
<td>客户端 携带认证名和密码 发起登录请求</td>
</tr>
<tr>
<td>服务器端验证成功，返回 token 给客户端</td>
<td>服务器端验证成功，将用户信息存储下来，生成一个 sessionId， 返回给客户端，并通知客户端将sessionId set到cookie中</td>
</tr>
<tr>
<td>客户端保存 token（通常是保存在Cookie或者LocalStorage中）</td>
<td>客户端自动执行服务器端将sessionId set到cookie中的命令，sessionId被自动保存在cookie中</td>
</tr>
<tr>
<td>客户端以后每次请求，都在Header中 携带该Token</td>
<td>客户端以后每次请求，都会自动将cookie中的sessionId发送给服务器端</td>
</tr>
<tr>
<td>服务器端，每次接收非登录请求，都验证Header中是否有token</td>
<td>服务器端，每次接收请求，都从cookie中取出sessionId，根据这个id找到存储的用户信息，如果有，说明登录，否则说明未登录或者已过期。</td>
</tr>
</tbody></table>
<p><strong>替换方案分析：</strong></p>
<ul>
<li>使用Shiro管理并存储登录了的用户信息，退出登录时候销毁服务器端用户信息，用类似于JWT作为SessionId，客户端采用JWT模式来保存和发送这个sessionId，保存在cookie或localStorage中，发送时用header；</li>
<li>为了接收非同源客户端的AJAX请求，服务器端需要启用 CORS（Cross-Origin Resource Sharing） 跨域访问，为指定域名的客户端开通白名单，以便接收其他不同客户端的请求；</li>
<li>服务器端采用JWT + Shiro的处理方式，服务器端使用Shiro处理保存用户信息到Redis，根据请求来更新JWT过期时间；</li>
<li>平滑的处理token过期，如果用户一直在活动，服务器端需要刷新token，客户端要配合。</li>
<li>JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限，比如某个用户更改了密码或者此用户权限被管理员更改，但只有JWT方式已经将其签证出去，还未到JWT失效时间服务器端拿他并没有办法的，也就是说拿着这个JWT的客户端依旧不用验证新的密码还是登录状态，权限依旧是之前的状态。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑，比如本项目中额外的逻辑即是使用Shiro+Redis进行一个解决。</li>
</ul>
<p><strong>总结：</strong></p>
<p>至于为什么要使用Shiro Redis +JWT 方案，有人可能会觉得这样不是和Session方案没什么区别之类的想法，或者直接使用JWT不就可以实现无状态的登录方式，也不需要对用户信息进行存储在内存之类的，但要考虑：</p>
<ol>
<li><p>在只使用JWT情况下虽然实现了无状态的登录方式，但安全得不到保障，比如用户修改了密码，一般情况下都是要进行重新验证用户名密码进行登录的，但由于只是使用JWT情况下，由于它的Token是一但签发给用户有效期没有过的时候是不能被销毁的，在别的设备上登录不能使其进行密码验证操作。</p>
</li>
<li><p>只有Session sessionId set到cookie中的的情况下实现跨域、单点登录、负载均衡、多平台开发是很不方便的。</p>
</li>
<li><p>虽然Shiro对比Session的方式同样是将用户信息存储在内存当中，但是参考到的文章中有个评论是这样说的：<a target="_blank" rel="noopener" href="https://www.v2ex.com/t/536256"> JWT的payload 大部分不需要存储在 redis 里，因为可以用签名来验证，真正需要的只有一个 uuid ；而 session 共享要全都存储。存储成本小</a>，即说明使用Shiro就可以节省服务器内存空间。</p>
<p>实验证明果然是Redis存储到内存的是UUID，登录某个用户获取Redis <code>KEYS *</code>信息：</p>
<p><img src="/images/java_dev/image-20220418144030225.png" alt="Redis存储某用户UUID"></p>
</li>
<li><p>在搭建起来Shiro Redis +JWT，偶然发现其实这个方案还有一个好处就是，当签发的Jwt请求一次受限资源，Shiro就会生成该用户的UUID，只要UUID不过期，以后就不用再携带Jwt进行受限资源访问，除非用户退出登录。</p>
</li>
</ol>
<h4 id="Apache-Shiro内部方法说明"><a href="#Apache-Shiro内部方法说明" class="headerlink" title="Apache Shiro内部方法说明"></a>Apache Shiro内部方法说明</h4><blockquote>
<p>要理解SHIRO-REDIS的配置，就得先学习Apache shiro基本工作原理以及内部组件之间是如何进行工作的，比如Apache Shiro 框架的一些专业名词。</p>
<p>详见：</p>
<p>铸鼎_ &gt; Apache-Shiro + JWT</p>
</blockquote>
<h4 id="SHIRO-REDIS"><a href="#SHIRO-REDIS" class="headerlink" title="SHIRO-REDIS"></a>SHIRO-REDIS</h4><blockquote>
<p>考虑到后面可能需要做集群、负载均衡等，所以就需要会话共享，而shiro的缓存和会话信息，我们一般考虑使用redis来存储这些数据，所以，我们不仅仅需要整合shiro，同时也需要整合redis。在开源的项目中，我们找到了一个starter可以快速整合shiro-redis。</p>
<p>来自官网的SHIRO-REDIS配置，以下是我的总结。</p>
<p>配置SHIRO-REDIS，官方文档里有好几种方式，比如，Shiro.ini专属Shiro内部的配置文件使用方式（跟Spring方式差不多）、Spring方式，当然最方便易用的还是Spring Boot的配置方式，直接可以用Java语言对SHIRO-REDIS进行配置，省去比如写xml配置Spring、Shiro.ini方式写配置的诸多不便。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://shiro.apache.org/spring-boot.html">Apache Shiro 官网</a></p>
<p><a target="_blank" rel="noopener" href="http://alexxiyang.github.io/shiro-redis/">SHIRO-REDIS 官方文档</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/alexxiyang/shiro-redis/blob/master/docs/README.md#spring-boot-starter">GitHub：shiro-redis </a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/xuxinstyle/p/9674816.html">博客园：shiro（java安全框架）</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/deng-cc/p/10789631.html">博客园：SpringBoot + Shiro + shiro.ini 的踩坑记录 </a></p>
<p><a target="_blank" rel="noopener" href="https://www.zhuawaba.com/post/17#4%E3%80%81%E6%95%B4%E5%90%88shiro+jwt%EF%BC%8C%E5%B9%B6%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB">Java问答社：整合shiro+jwt，并会话共享</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PQ4y1P7hZ?p=4">Bilibili：Shiro 整合 JWT逻辑分析</a></p>
<p><a target="_blank" rel="noopener" href="http://www.andrew-programming.com/2019/01/23/springboot-integrate-with-jwt-and-apache-shiro/#How_Could_We_Use_JWT_In_Our_Application">SpringBoot Integrate With JWT And Apache Shiro</a></p>
</blockquote>
<p><strong>Spring Boor配置SHIRO-REDIS</strong></p>
<p>无论是哪种配置方式，<strong>Web项目</strong>基本上都是下面的结构，按照这个结构官网上提供的那几种配置方式都可以行得通，但会发现为什么没有Filter相关的模块，原因是以下的配置方式没有涉及到JWT，只是自带的SHIRO默认Session过滤器处理方式，整合JWT配置请参阅：<a target="_blank" rel="noopener" href="http://www.andrew-programming.com/2019/01/23/springboot-integrate-with-jwt-and-apache-shiro/#How_Could_We_Use_JWT_In_Our_Application">SpringBoot Integrate With JWT And Apache Shiro</a>。</p>
<p><img src="/images/java_dev/image-20220410135122638.png" alt="配置过程Bean系结构"></p>
<p><strong>主要是要了解一下Spring Boot的SHIRO-REDIS配置方式和过程：</strong></p>
<p>建议先看参考资料，再看Spring Boot配置代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShiroConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtFilter jwtFilter;		<span class="comment">//自定义</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span>       <span class="comment">//redisSessionDAO:shrio-redis实现redis进行CRUD 处理 Session的方式</span></span><br><span class="line">    <span class="keyword">public</span> SessionManager <span class="title function_">sessionManager</span><span class="params">(RedisSessionDAO redisSessionDAO)</span> &#123;</span><br><span class="line">        <span class="type">DefaultWebSessionManager</span> <span class="variable">sessionManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSessionManager</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//sessionManager: Shiro 做了一个自己的 sessionManager 来管理Session</span></span><br><span class="line">        <span class="comment">// inject redisSessionDAO</span></span><br><span class="line">        sessionManager.setSessionDAO(redisSessionDAO);</span><br><span class="line">        <span class="keyword">return</span> sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Shiro核心（SecurityManager）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> accountRealm      //自定义Realm</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sessionManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> redisCacheManager</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DefaultWebSecurityManager <span class="title function_">securityManager</span><span class="params">(AccountRealm accountRealm,</span></span><br><span class="line"><span class="params">                                                   SessionManager sessionManager,</span></span><br><span class="line"><span class="params">                                                   RedisCacheManager redisCacheManager)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//SecurityManager是一定要有的，但是Shiro中读取shiro返回的是 DefaultSecurityManager，因为是Web应用我们需要的是 DefaultWebSecurityManager，所以把 DefaultSecurityManager的Realms 提出来给 DefaultWebSecurityManager</span></span><br><span class="line">        <span class="type">DefaultWebSecurityManager</span> <span class="variable">securityManager</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultWebSecurityManager</span>(accountRealm);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//inject sessionManager（上面函数的SessionManager）</span></span><br><span class="line">        securityManager.setSessionManager(sessionManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// inject redisCacheManager</span></span><br><span class="line">        securityManager.setCacheManager(redisCacheManager);</span><br><span class="line">        <span class="keyword">return</span> securityManager;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义哪些链接需要经过哪些过滤器（可定义多个不同的过滤器对链接进行一个分类过滤处理）</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterChainDefinition <span class="title function_">shiroFilterChainDefinition</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//过滤器链接定义器赋值链接（Spring Boot 配置过滤链接方式省去了Shiro官方写配置文件方式）</span></span><br><span class="line">        <span class="type">DefaultShiroFilterChainDefinition</span> <span class="variable">chainDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShiroFilterChainDefinition</span>();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> <span class="title class_">LinkedHashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        filterMap.put(<span class="string">&quot;/**&quot;</span>, <span class="string">&quot;jwt&quot;</span>);	<span class="comment">//自定义了一个JWT专属的过滤器,拦截所有API请求</span></span><br><span class="line">        chainDefinition.addPathDefinitions(filterMap);</span><br><span class="line">        <span class="keyword">return</span> chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//将shiroFilterChainDefinition()里某个过滤器设置SecurityManager、ShiroFilterChainDefinition过滤的链接、设置自定义的过滤器</span></span><br><span class="line">    <span class="meta">@Bean(&quot;shiroFilterFactoryBean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ShiroFilterFactoryBean <span class="title function_">shiroFilterFactoryBean</span><span class="params">(SecurityManager securityManager,</span></span><br><span class="line"><span class="params">                                                         ShiroFilterChainDefinition shiroFilterChainDefinition)</span> &#123;</span><br><span class="line">        <span class="type">ShiroFilterFactoryBean</span> <span class="variable">shiroFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShiroFilterFactoryBean</span>();</span><br><span class="line">        <span class="comment">//给链接工厂Bean设置安全管理者</span></span><br><span class="line">        shiroFilter.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 设置自定义的JWT过滤器</span></span><br><span class="line"><span class="comment">         * **关键步骤**</span></span><br><span class="line"><span class="comment">         * 如果没有会使用Shiro默认的Session方式进行处理</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String, Filter&gt; filters = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        filters.put(<span class="string">&quot;jwt&quot;</span>, jwtFilter);</span><br><span class="line">        shiroFilter.setFilters(filters);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; filterMap = shiroFilterChainDefinition.getFilterChainMap();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.将链接定义器的链接赋值给链接工厂Bean</span></span><br><span class="line">        shiroFilter.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        <span class="keyword">return</span> shiroFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><strong>自定义Ream</strong>了规则为<code>AccountRealm</code>；</li>
<li>原生的Shiro使用的Session方式，过滤器也是Session方式，要<strong>自定义过滤器</strong>JwtFilter，后面介绍自定义JwtFilter。</li>
<li><code>ShiroFilterFactoryBean</code>定义链接要走过滤器。</li>
</ul>
<p>Ream规则定义<code>AccountRealm</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountRealm</span> <span class="keyword">extends</span> <span class="title class_">AuthorizingRealm</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtil jwtUtil;        <span class="comment">//自定义</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supports</span><span class="params">(AuthenticationToken token)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token <span class="keyword">instanceof</span> JwtToken;</span><br><span class="line">    &#125;       <span class="comment">//JwtToken自定义</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//授权管理</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthorizationInfo <span class="title function_">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principals)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//身份验证（@RequiresAuthentication注解触发执行）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationInfo <span class="title function_">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//token本来就是JwtToken子类的，才可向下转型，访问子类的独有方法</span></span><br><span class="line">        <span class="type">JwtToken</span> <span class="variable">jwtToken</span> <span class="operator">=</span> (JwtToken) token;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//(String) jwtToken.getPrincipal()得到JWT的字符串再将字符串JWT放入jwtUtils.getClaimByToken(String token),解析出Subject即UserID</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> jwtUtil.getClaimByToken((String) jwtToken.getPrincipal()).getSubject();</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(Long.valueOf(userId));</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnknownAccountException</span>(<span class="string">&quot;账户不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (user.getEnable().equals(<span class="string">&quot;0&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">LockedAccountException</span>(<span class="string">&quot;账户已被锁定&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">AccountProfile</span> <span class="variable">profile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountProfile</span>();</span><br><span class="line">        BeanUtil.copyProperties(user, profile);		<span class="comment">//hutool工具复制属性</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SimpleAuthenticationInfo</span>(profile, jwtToken.getCredentials(), getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><p>其中最重要的还是要实现身份认证和授权管理；</p>
</li>
<li><p>可见Ream类在Shiro内不仅只是用户资源获取，还有身份验证和权限管理；</p>
</li>
<li><p><code>JwtUtil</code>需要自定义，主要对处理JWT相关业务，比如生成JWT内部信息（Header、Payload）、加密解密，后面介绍自定义的<code>JwtUtil</code>；</p>
</li>
<li><p>JwtToken需要自定义;</p>
</li>
<li><p><code>AccountProfile</code>自定义，要保证其内部变量在数据库里数值唯一;</p>
</li>
<li><p>返回 <code>new SimpleAuthenticationInfo(profile, jwtToken.getCredentials(), getName());</code>，猜测应该是将用户的唯一信息写入Redis，就像Session那样在内存中用户登录就为该用户建立一个Session，生成一个SessionID返回给客户端，而目前的Shiro+Jwt方式就返回给用户Jwt。</p>
<p>AccountProfile：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountProfile</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String avatarUrl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p>JwtUtil:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;schoolwall.jwt&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//HS512加密需要传一个secret</span></span><br><span class="line">    <span class="keyword">private</span> String secret;</span><br><span class="line">    <span class="comment">//过期时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> expire;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">private</span> String header;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成jwt token</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateToken</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">nowDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        <span class="comment">//过期时间</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">expireDate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(nowDate.getTime() + expire);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Jwts.builder()</span><br><span class="line">                .setHeaderParam(<span class="string">&quot;typ&quot;</span>, <span class="string">&quot;JWT&quot;</span>)</span><br><span class="line">                .setSubject(userId+<span class="string">&quot;&quot;</span>)</span><br><span class="line">                .setIssuedAt(nowDate)</span><br><span class="line">                .setExpiration(expireDate)</span><br><span class="line">                .signWith(SignatureAlgorithm.HS512, secret)</span><br><span class="line">                .compact();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解码传递过来的JWT（解码校验是否是本服务器签证的JWT）</span></span><br><span class="line">    <span class="keyword">public</span> Claims <span class="title function_">getClaimByToken</span><span class="params">(String token)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Jwts.parser()</span><br><span class="line">                    .setSigningKey(secret)</span><br><span class="line">                    .parseClaimsJws(token)</span><br><span class="line">                    .getBody();</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;validate is token error &quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * token是否过期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>  true：过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isTokenExpired</span><span class="params">(Date expiration)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> expiration.before(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li><p>其中刚开始定义的三个变量都是经过Spring Boot的配置文件里面定义的，方便代码的维护；</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schoolwall:</span></span><br><span class="line">  <span class="attr">jwt:</span></span><br><span class="line">    <span class="comment"># 加密秘钥（可以理解为服务器持有的私钥）</span></span><br><span class="line">    <span class="attr">secret:</span> <span class="string">***</span></span><br><span class="line">    <span class="comment"># token有效时长，7天，单位毫秒</span></span><br><span class="line">    <span class="attr">expire:</span> <span class="number">604800000</span></span><br><span class="line">    <span class="attr">header:</span> <span class="string">Authorization</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>getClaimByToken其实就是对传过来的JWT进行解码。</p>
</li>
</ul>
<p>JwtToken：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtToken</span> <span class="keyword">implements</span> <span class="title class_">AuthenticationToken</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String token;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JwtToken</span><span class="params">(String jwt)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.token = jwt;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getPrincipal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getCredentials</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>JwtFilter：</p>
<p><img src="/images/java_dev/image-20220412202038661.png" alt="image-20220412202038661"></p>
<p>逻辑关系用代码进行表示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 安康学院校园墙后端</span></span><br><span class="line"><span class="comment"> * &lt;/p&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> fuding 铸鼎_ Blog: https://ding-f.gitee.io/</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2022 2022/4/14 11:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//JwtFilter明显继承的是org.apache.shiro.web.filter.authc.AuthenticatingFilter，这个过滤器原本是Session的，重写了内部方法，让Jwt方式进行处理。</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JwtFilter</span> <span class="keyword">extends</span> <span class="title class_">AuthenticatingFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JwtUtil jwtUtil;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//拦截用户请求，获取JWT</span></span><br><span class="line">    <span class="keyword">protected</span> AuthenticationToken <span class="title function_">createToken</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HttpServletRequest userRequest= (HttpServletRequest) request;</span><br><span class="line">        <span class="comment">//获取jwt，放在Http协议的头部的&quot;Authorization&quot;</span></span><br><span class="line">        String jwt=userRequest.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwt)) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JwtToken</span>(jwt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">//获取到JWT（null or String）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onAccessDenied</span><span class="params">(ServletRequest request, ServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        HttpServletRequest userRequest= (HttpServletRequest) request;</span><br><span class="line">        String jwt=userRequest.getHeader(<span class="string">&quot;Authorization&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果登录时候还没有JWT，直接放行访问API</span></span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isEmpty(jwt)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;    <span class="comment">//有jwt</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//解析jwt</span></span><br><span class="line">            <span class="type">Claims</span> <span class="variable">claim</span> <span class="operator">=</span> jwtUtil.getClaimByToken(jwt);</span><br><span class="line">            <span class="comment">//jwt解析失败或者已经过了保质期</span></span><br><span class="line">            <span class="keyword">if</span>(claim==<span class="literal">null</span> || jwtUtil.isTokenExpired(claim.getExpiration()))&#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ExpiredCredentialsException</span>(<span class="string">&quot;token失效，请重新登录&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//jwt没有失效且合法,直接调用Shiro进行登录，生成UUID</span></span><br><span class="line">        <span class="keyword">return</span> executeLogin(request,response);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//登录失败时处理失败时候的异常，返回异常的原因打印输出</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">onLoginFailure</span><span class="params">(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response)</span> &#123;</span><br><span class="line">        HttpServletResponse httpServletResponse=(HttpServletResponse) response;</span><br><span class="line">        </span><br><span class="line">        Throwable throwable=e.getCause()==<span class="literal">null</span> ? e:e.getCause();</span><br><span class="line">        Result result=Result.fail(throwable.getMessage());</span><br><span class="line">        String jsonfailmess= JSONUtil.toJsonStr(result);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            httpServletResponse.getWriter().print(jsonfailmess);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (IOException ioException)&#123;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<ul>
<li>其中<code>onLoginFailure</code>方法不必须进行复写的，但因为项目是前后端分离的模式进行开发的，一定要打印错误信息为JSON形式输出到前端，复写了这个方法当调用<code>executeLogin(request,response)</code>抛出异常就可以将其捕获并输出JSON错误信息，原先不进行复写只是<code>return false</code>禁止下一步。</li>
</ul>
<p><strong>最后优化一下总体配置</strong></p>
<p>方便对项目进行管理加上以下配置信息:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">shiro-redis:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">redis-manager:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379</span></span><br></pre></td></tr></table></figure>

<p>若使用shiro和springboot热部署spring-boot-devtools工具,则需要添加一个文件src&#x2F;main&#x2F;resources&#x2F;META-INF&#x2F;spring-devtools.properties,这样就解决两个工具之间的冲突报错：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">restart.include.shiro-redis</span>=<span class="string">/shiro-[\\w-\\.]+jar</span></span><br></pre></td></tr></table></figure>













<h4 id="跨域认证的问题"><a href="#跨域认证的问题" class="headerlink" title="跨域认证的问题"></a>跨域认证的问题</h4><p>互联、网服务离不开用户认证。一般流程是下面这样。</p>
<ol>
<li><p>用户向服务器发送用户名和密码。</p>
</li>
<li><p>服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</p>
</li>
<li><p>服务器向用户返回一个 session_id，写入用户的 Cookie。</p>
</li>
<li><p>用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</p>
</li>
<li><p>服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</p>
</li>
</ol>
<p>这种模式的问题在于，扩展性（scaling）不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p>
<p><strong>Session与Shiro JWT方式不同之处在于：</strong></p>
<ul>
<li>Session登录方式，sessionId是自动保存到cookie中的，且发送请求时，浏览器是自动附加上cookie信息的，这一切的前提是：前后端处于同一域下面，如果不是相同的域，cookie信息是不会自动提交给后端的。</li>
<li>Session登录方式，服务器端缓存了登录用户的信息，而JWT方式，服务器端可以不存储任何信息，只要验证Token通过即可，不一定要知道用户信息，实际上JWT方式，JWT的Token本身存储了一些关键数据（比如用户名，过期时间），token是根据密码学算法生成的，无法更改token里面的内容。</li>
<li>Session登录方式，缓存的过期时间是由服务器端设定的，而JWT方式，token信息中自带过期时间（服务器端生成token的时候就设定好了过期时间），过期之后token验证失败。</li>
<li>Session登录方式，优点是不存在CORS跨域问题，且服务器端处理登录过期很简单、自然。但不支持跨域访问在某些情况下是硬伤！！(比如APP登录)</li>
<li>Session登录方式，sessionId是自动保存和发送的，而JWT方案，客户端需要写代码实现token的保存，并配置AJAX的header实现token的发送。</li>
</ul>
<p><img src="/images/java_dev/image-20220412201939841.png" alt="image-20220412201939841"></p>
<h3 id="测试-问题处理"><a href="#测试-问题处理" class="headerlink" title="测试&amp;问题处理"></a>测试&amp;问题处理</h3><blockquote>
<p>搭建好Shiro Redis + Jwt方式，实验过程中发现的一些问题。</p>
</blockquote>
<h4 id="Redis缓存UUID的Key-Value有效期与Jwt有效期"><a href="#Redis缓存UUID的Key-Value有效期与Jwt有效期" class="headerlink" title="Redis缓存UUID的Key-Value有效期与Jwt有效期"></a>Redis缓存UUID的Key-Value有效期与Jwt有效期</h4><p><img src="/images/java_dev/image-20220412202038661.png" alt="image-20220412202038661"></p>
<p><strong>登录了后台中ID&#x3D;2的用户：</strong></p>
<p>Post方式携带Json信息<code>user</code> <code>passwd</code>访问用户登录接口<code>http://0.0.0.0:3000/schoolwall/user/login</code> 无Jwt情况，登录不经过JwtFilter，直接进入用户登录接口，但此接口代码未经过Shiro，只是下发了JWT。</p>
<p><img src="/images/java_dev/image-20220418155009696.png" alt="image-20220418155009696"></p>
<p>登录后如果没有访问到带有<code>@RequiresAuthentication</code> 的接口，Shiro Redis是不会生成用户信息到Redis缓存的，也就是说没有建立用户的UUID：</p>
<p><img src="/images/java_dev/image-20220418161220066.png" alt="image-20220418161220066"></p>
<p>只有访问了带有带有<code>@RequiresAuthentication</code> 的接口，才会生成该用户UUID，且带有有效时间（Redis默认Keys过期时间1800，换算过来是半个小时）：</p>
<p><img src="/images/java_dev/image-20220418162027754.png" alt="image-20220418162027754"></p>
<p>如果等到过了这半个小时，但Jwt有效时间没有过，再次登录就会生成另一个新的UUID，虽然是同一个用户，但UUID就会不一样：</p>
<p><img src="/images/java_dev/image-20220418162124943.png" alt="该UUID已经被删除并过期"></p>
<p><img src="/images/java_dev/image-20220418162718201.png" alt="携带未过期的同一个用户Jwt进行访问已登录资源"></p>
<p><img src="/images/java_dev/image-20220418162920431.png" alt="同一个用户新生成的UUID"></p>
<p>但如果是Jwt时间已过就会阻止用户访问已登录资源。</p>
<h4 id="Jwt重新签发"><a href="#Jwt重新签发" class="headerlink" title="Jwt重新签发"></a>Jwt重新签发</h4><blockquote>
<p>以下是同一个用户，调用登录接口在Jwt没有过期的情况下进行的两次登录，即重新签发Jwt，本次签发的Jwt与上次签发的毫无关联，且均有效。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SchoolwallApplicationTests</span> &#123;</span><br><span class="line">		<span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">jwtTimeTest</span><span class="params">()</span>&#123;</span><br><span class="line">        DateFormat dateFormat=DateFormat.getDateInstance(DateFormat.FULL,Locale.CHINA);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;现在时间：&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>().getTime()+<span class="string">&quot;转换为本地时间格式：&quot;</span>+dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>()));</span><br><span class="line"></span><br><span class="line">      <span class="comment">//同一个用户第一次Jwt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">claim1</span> <span class="operator">=</span> Base64.decodeStr(<span class="string">&quot;eyJzdWIiOiIyIiwiaWF0IjoxNjUwMjEwMzQ1LCJleHAiOjE2NTA4MTUxNDV9&quot;</span>);</span><br><span class="line">      <span class="comment">//同一个用户第二次刷新后的Jwt</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">claim2</span> <span class="operator">=</span> Base64.decodeStr(<span class="string">&quot;eyJzdWIiOiIyIiwiaWF0IjoxNjUwMjY0NDEyLCJleHAiOjE2NTA4NjkyMTJ9&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String Header=Base64.decodeStr(<span class="string">&quot;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9&quot;</span>);</span><br><span class="line">        System.out.println(Header);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;------------------用户第一次登录实验----------------&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;用户登录第一次后的JWT-Payload：&quot;</span>+claim1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//以下为了验证猜想：Jwt自己转换时间戳为秒</span></span><br><span class="line">        <span class="type">long</span> iat=<span class="number">1650210345</span>;    <span class="comment">//签发时间（秒）</span></span><br><span class="line">        <span class="type">long</span> exp=<span class="number">604800000</span>/<span class="number">1000</span>;    <span class="comment">//有时间转换为秒</span></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> i=iat+exp;     <span class="comment">//过期时间（秒）</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;1650210345[签发时间戳] + &quot;</span>+<span class="string">&quot;：604800[系统设置有效期时间戳（换算成秒）]&quot;</span>+i+<span class="string">&quot;【过期时间戳】&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        String formatJwtDate1=formatJwtDate(iat,i);</span><br><span class="line"></span><br><span class="line">        System.out.println(formatJwtDate1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;------------------用户第二次登录实验----------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户登录第二次后的JWT-Payload：&quot;</span>+claim2);</span><br><span class="line"></span><br><span class="line">        String formatJwtDate2=formatJwtDate(<span class="number">1650264412</span>,<span class="number">1650869212</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(formatJwtDate2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span>  String <span class="title function_">formatJwtDate</span><span class="params">(<span class="type">long</span> iat,<span class="type">long</span> exp)</span>&#123;</span><br><span class="line">        DateFormat dateFormat=DateFormat.getDateInstance(DateFormat.FULL,Locale.CHINA);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> iatms=iat*<span class="number">1000</span>;</span><br><span class="line">        <span class="type">long</span> expms=exp*<span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">        String formatIatms= dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>(iatms));</span><br><span class="line">        String formatExpms= dateFormat.format(<span class="keyword">new</span> <span class="title class_">Date</span>(expms));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;签证时间：&quot;</span>+formatIatms+<span class="string">&quot;\n过期时间:&quot;</span>+formatExpms;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>输出结果：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">现在时间：<span class="number">1650267596485</span>转换为本地时间格式：<span class="number">2022</span>年<span class="number">4</span>月<span class="number">18</span>日 星期一</span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span><span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span><span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span><span class="string">&quot;HS512&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">------------------用户第一次登录实验----------------</span><br><span class="line">用户登录第一次后的JWT-Payload：<span class="punctuation">&#123;</span><span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span><span class="number">1650210345</span><span class="punctuation">,</span><span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span><span class="number">1650815145</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="number">1650210345</span><span class="punctuation">[</span>签发时间戳<span class="punctuation">]</span> + ：<span class="number">604800</span><span class="punctuation">[</span>系统设置有效期时间戳（换算成秒）<span class="punctuation">]</span><span class="number">1650815145</span>【过期时间戳】</span><br><span class="line">签证时间：<span class="number">2022</span>年<span class="number">4</span>月<span class="number">17</span>日 星期日</span><br><span class="line">过期时间<span class="punctuation">:</span><span class="number">2022</span>年<span class="number">4</span>月<span class="number">24</span>日 星期日</span><br><span class="line">------------------用户第二次登录实验----------------</span><br><span class="line">用户登录第二次后的JWT-Payload：<span class="punctuation">&#123;</span><span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span><span class="string">&quot;2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span><span class="number">1650264412</span><span class="punctuation">,</span><span class="attr">&quot;exp&quot;</span><span class="punctuation">:</span><span class="number">1650869212</span><span class="punctuation">&#125;</span></span><br><span class="line">签证时间：<span class="number">2022</span>年<span class="number">4</span>月<span class="number">18</span>日 星期一</span><br><span class="line">过期时间<span class="punctuation">:</span><span class="number">2022</span>年<span class="number">4</span>月<span class="number">25</span>日 星期一</span><br><span class="line"></span><br><span class="line">Process finished with exit code <span class="number">0</span></span><br></pre></td></tr></table></figure>



<p>同一用户情况下带着之前的Jwt重新登录就会刷新Jwt，如果没带之前的Jwt，重新登录就会将之前登录过的Jwt重新返回给用户，但UUID不过期，正常请求受限资源情况下不会更换UUID。</p>
<h4 id="Shiro-Session（UUID）特性"><a href="#Shiro-Session（UUID）特性" class="headerlink" title="Shiro Session（UUID）特性"></a>Shiro Session（UUID）特性</h4><blockquote>
<p>登录测试过程中发现，客户端被签发Jwt后，客户端只需提交一次Jwt验证，Shiro就将根据用户提交的Jwt生成Shiro SessionID（UUID）并记录到Redis中，只要Redis中UUID不过期，用户所有对受限资源的请求都可以不带Jwt，但用户如果退出登录，Shiro Redis就会删除该用户的Session UUID。</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorage.html">微信开发者官网：wx.setStorage(Object object)</a></p>
</blockquote>
<p><strong>登录ID&#x3D;1用户：</strong></p>
<p><img src="/images/java_dev/image-20220419115019290.png" alt="Redis Key为Null"></p>
<p><img src="/images/java_dev/image-20220419114544908.png" alt="执行登录ID=1用户"></p>
<p>签证了Jwt但未进行受限资源请求，查询Redis，Shiro未生成该用户UUID：</p>
<p><img src="/images/java_dev/image-20220419115019290.png" alt="未进行受限资源请求"></p>
<p>带着签证的Jwt请求受限资源：</p>
<p><img src="/images/java_dev/image-20220419115707509.png" alt="200代表访问受限资源成功"></p>
<p><img src="/images/java_dev/image-20220419115758000.png" alt="Shiro生成该用户Session UUID"></p>
<p>接着上一步骤，不进行上传Jwt，依然访问成功：</p>
<p><img src="/images/java_dev/image-20220419115918276.png" alt="取消了Authorization头信息"></p>
<p><strong>该用户访问退出登录接口：</strong></p>
<p><img src="/images/java_dev/image-20220419120944673.png" alt="200代表退出成功"></p>
<p>查询Redis：</p>
<p><img src="/images/java_dev/image-20220419115019290.png" alt="被Shiro删除"></p>
<p>再次登录UUID也会不同。</p>
<p><strong>删除Session UUID（相当于退出登录），进行测试：</strong></p>
<p><img src="/images/java_dev/image-20220419120120313.png" alt="删除该用户UUID"></p>
<p><img src="/images/java_dev/image-20220419120105575.png" alt="Session UUID不存在 认证失败"></p>
<p>再次携带访问会成功，但Session UUID会和之前不一致：</p>
<p><img src="/images/java_dev/image-20220419115707509.png" alt="携带再次访问"></p>
<p>再次查询Redis：</p>
<p><img src="/images/java_dev/image-20220419120505649.png" alt="同一用户不一致UUID"></p>
<p><strong>总结：</strong></p>
<ul>
<li>可以利用这个Shiro这个特性，降低安全风险，因为可以不用每次都携带着Jwt，比普通Session方式更加安全。</li>
<li>本项目是小程序后端，Jwt签证7天有效期，可以将Redis存入的UUID设置长一些，比如说设置UUID为1天时间有效期，如果过期就需要小程序端重新传递Jwt，重新登录判断Jwt是否过期，过期的话如果登录成功就需要重新进行签证，未过期不进行重新签证，Jwt保存在小程序的Storage内部，如果用户点击退出登录，不会清除Jwt，当小程序端检查微信服务器Session_key如果过期就会重新获取Code，此时的Session_key（保证客户端数据传过来可以与微信服务器数据对应）也就重新获取了，所以当Session_key有效期过了就应该重新清除Jwt，没有Jwt小程序后端就需要重新登录，重新登录就会判断到没有Jwt就会重新签证一个，这样就会使得信息更加安全，UUID有效期可以设置更长一些，这样就不会频繁的传递Jwt，还可以将Jwt信息使用微信提供的<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorage.html">wx.setStorage(Object object)</a>对其Jwt信息进行一个加密，加强安全性。</li>
</ul>
<h3 id="文件上传下载"><a href="#文件上传下载" class="headerlink" title="文件上传下载"></a>文件上传下载</h3><blockquote>
<p>项目中上传图片还是涉及到了文件上传下载。分析小程序后端要搭建在云服务器，如果文件服务器搭建在云服务器的话还是会占用不小的系统资源。解决方案一共有两个，一、单独买图床服务器，但好像没啥好玩的。二、重新开启一个项目，将这个程序专门跑在自己家里作为小程序文件上传下载服务器。本着自己喜欢技术决定还是选择方案二比较合适。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-io/">Commons IO – Commons IO Overview</a></p>
<p><a target="_blank" rel="noopener" href="https://commons.apache.org/proper/commons-fileupload/using.html">FileUpload – Using FileUpload</a></p>
</blockquote>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><blockquote>
<p>Shiro 在处理登录请求的时候，就会抛出相应的异常，比如用户不存在、用户校验密码错误、用户被禁用等异常，由于是前后端分离项目，不处理只会默认返回tomcat或者nginx的5XX页面（spring boot 默认情况下会映射到 &#x2F;error 进行异常处理，提示并不十分友好），这样处理对于普通用户来说并不友好，处理必要的结果为Json信息返回给前端还是很必要的。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.zhuawaba.com/post/17#5%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">Java问答社：超详细！4小时开发一个SpringBoot+vue前后端分离博客项目！！</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PQ4y1P7hZ?p=8">Bilibili：4小时项目全局异常处理</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/UncleWang001/p/10949318.html">博客园：Spring Boot 系列（八）@ControllerAdvice 拦截异常并统一处理</a></p>
</blockquote>
<h2 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h2><h3 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h3><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_17555933/article/details/101445526">mysql使用utf8mb4经验吐血总结</a></p>
</blockquote>
<p>创建新的数据库，选用字符集utf8mb4 排序字符集utf8mb4_unicode_ci：</p>
<p><img src="/images/java_dev/new_database.png"></p>
<ul>
<li>MySQL在 5.5.3 之后增加了 <code>utf8mb4</code> 字符编码，mb4即 most bytes 4。简单说 utf8mb4 是 utf8 的超集并完全兼容utf8，能够用四个字节存储更多的字符。也就是当你的数据库里要求能够存入这些表情或宽字符时，可以把字段定义为 utf8mb4</li>
<li>常见排序字符集有两种：<ul>
<li><code>utf8mb4_unicode_ci</code> 是基于标准的Unicode来排序和比较，能够在各种语言之间精确排序</li>
<li><code>utf8mb4_general_ci</code> 没有实现Unicode排序规则，在遇到某些特殊语言或字符是，排序结果可能不是所期望的。</li>
<li><code>utf8mb4_general_ci</code> 在比较和排序的时候更快</li>
<li><code>utf8mb4_unicode_ci</code> 在特殊情况下，Unicode排序规则为了能够处理特殊字符的情况，实现了略微复杂的排序算法。</li>
</ul>
</li>
<li>但目前来说，性能已经不是这个时代的瓶颈了，推荐是 <code>utf8mb4_unicode_ci</code>，将来 8.0 里也极有可能使用变为默认的规则。</li>
</ul>
<h3 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h3><blockquote>
<p>JSON分析：</p>
<p>数据库可以多几个前端不需要的字段，但不能缺少前端所需字段。</p>
<p>查询出JSON数据也不能少于前端所需元素，可以多但不能少元素。</p>
<p>整体分析：</p>
<p>刚开始觉得应该设计数据库可能要和WordPress数据库字段基本上对应的差不多，其实还是要具体问题具体分析的，就比如小程序里面可能就不需要WordPress前端那样需要处理那么多的数据，比如一个查看帖子详情的页面可能就只需要标题、内容、发布时间、帖子插图等，但如果换作WordPress前端那样对数据库查询可能就需要更多的信息即字段，以下就是我个人对本项目数据库设计的过程和思路分析。</p>
</blockquote>
<h4 id="10篇帖子为1页，分页获取列表-2"><a href="#10篇帖子为1页，分页获取列表-2" class="headerlink" title="10篇帖子为1页，分页获取列表"></a>10篇帖子为1页，分页获取列表</h4><blockquote>
<p>很明显下面的接口都是传入per_page&#x3D;10代表了每10篇分一页，orderby&#x3D;date代表按照时间排序，order&#x3D;desc排序为倒序（最新时间排在前）。</p>
</blockquote>
<p>小程序源码：</p>
<p><img src="/images/java_dev/2022-03-30_11.17.15_AM.png" alt="Screen Shot 2022-03-30 at 11.17.15 AM"></p>
<p><img src="/images/java_dev/image-20220330112045237.png" alt="image-20220330112045237"></p>
<p>调用WordPress后端接口标记关键数据<a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/watch-life-net/v1/posts?per_page=10&orderby=date&order=desc&page=1%EF%BC%9A">https://www.watch-life.net/wp-json/watch-life-net/v1/posts?per_page=10&amp;orderby=date&amp;order=desc&amp;page=1：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span>		<span class="comment">//说明传过来的数据是一个列表</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2006</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T11:53:54&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;date_gmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T03:53:54&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/?p=2006&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;modified&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T12:38:43&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;modified_gmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T04:38:43&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;slug&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a-slight-illness-logs&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;publish&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;post&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/life-thinking\/a-slight-illness-logs.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5fae\u6059\u7410\u8bb0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;excerpt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;p&gt;\u7528\u6742\u4e71\u65e0\u7ae0\u7684\u6587\u5b57\uff0c\u8bb0\u5f55\u4e00\u6bb5\u4f4f\u9662\u6cbb\u7597\u75d4\u75ae\u4e4b\u75be\u7684\u601d\u8003\uff0c\u4ee5\u6b64\u4f5c\u4e3a\u7eaa\u5ff5\u3002&lt;\/p&gt;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protected&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;featured_media&quot;</span><span class="punctuation">:</span> <span class="number">2007</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;open&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ping_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;open&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sticky&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;meta&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">165</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">261</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">42</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">363</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">267</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">1186</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_thumbnail_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-113x150.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content_first_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_medium_image_300&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-225x300.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_thumbnail_image_624&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_frist_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;post_medium_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-225x300.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_large_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_full_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_all_images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;imagesurl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image0&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;videoAdId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;adunit-54154da9ac037533&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAdId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;adunit-04c7f94fa0c24c57&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAdEvery&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;total_comments&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;category_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u968f\u601d\u5076\u5f97&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">547</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next_post_id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next_post_title&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;previous_post_id&quot;</span><span class="punctuation">:</span> <span class="number">1748</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;previous_post_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u7236\u4eb2\u4e0d\u9700\u8981\u8282\u65e55&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">//省略了后面的9个列表元素</span></span><br><span class="line">  <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>



<p>数据库设计：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sw_posts` (</span><br><span class="line">  `id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `enable` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  `modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  `total_comments` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `post_medium_image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;../../images/error.jpg&#x27;</span>,</span><br><span class="line">  `like_count` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `pageviews` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `type_status_date` (`type`,`enable`,`<span class="type">date</span>`,`id`),</span><br><span class="line">  KEY `author` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1962</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>SQL语句：</p>
<p>MyBatis Plus实现，不用写SQL。</p>
<p>后端实现过程：</p>
<blockquote>
<p>后端开发 &gt; MyBatis Plus &gt; 10篇帖子为1页，分页获取列表</p>
</blockquote>
<h4 id="评论列表"><a href="#评论列表" class="headerlink" title="评论列表"></a>评论列表</h4><blockquote>
<p>评论列表一般网页实现方式就以下参考中三种方式，我专门参考了Bilibili上的评论列表，但是实现起来还是网上找了两个类似Java实现方式进行了分析，他们都是这三种方式进行实现的，但是网上的帖子其实第三种也就是参考Bilibili上那种最复杂的评论列表其实讲的原理模糊不清的，只有自己开动大脑进行自己构思，当然也结合以下博客的帖子进行了综合的分析。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zukxu/p/13919501.html">Java徐小白：Java实现评论回复功能</a></p>
<p><a target="_blank" rel="noopener" href="http://www.zyiz.net/tech/detail-115177.html">Howlet：评论功能的简单实现</a></p>
</blockquote>
<p>小程序源码：</p>
<p><img src="/images/java_dev/image-20220329205536706.png" alt="image-20220329205536706"></p>
<p>可以分析以上的方式就是参考博文里的的<strong>套娃型</strong>，即第二种实现方式，但是这样的评论列表有一个明显的缺点，就是套娃层数多了数据就会被前端隐藏，虽然后端可能实现了更多层的套娃。</p>
<p>调用WordPress后端接口，以下的例子就是一个经典的套娃型评论后端实现API：<a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/watch-life-net/v1/comment/getcomments?postid=1959&limit=10&page=1&order=desc%EF%BC%9A">https://www.watch-life.net/wp-json/watch-life-net/v1/comment/getcomments?postid=1959&amp;limit=10&amp;page=1&amp;order=desc：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;success&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u83b7\u53d6\u8bc4\u8bba\u6210\u529f&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;200&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">			<span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;239892&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5c1b \u660a`&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/ajNVdqHZLLAF1uErNlC9dZGul5ZCYIFoUDSXdA1aIFcgtgOMMUicngGrTULc1Il33yvaUYz1K0cibeYkf3Kte9SA\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-12-15&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u63d2\u4ef6\u5728\u54ea\u91cc\u4e0b\u8f7d\u5440&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">            <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15521&quot;</span><span class="punctuation">,</span></span><br><span class="line">        </span><br><span class="line">            <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                  </span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;239893&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  </span><br><span class="line">                    <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;xjb&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;..\/..\/images\/gravatar.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-12-15&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u8fd8\u6ca1\u6709\u63d0\u4f9b\u4e0b\u8f7d\u5730\u5740\uff0c\u6b63\u5728\u505a\u6700\u540e\u7684\u5b8c\u5584\uff0c\u5373\u5c06\u63d0\u4f9b\u4e0b\u8f7d\u3002&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                        <span class="punctuation">&#123;</span></span><br><span class="line">                            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;239909&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;az&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;..\/..\/images\/gravatar.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-12-21&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u671f\u5f85\u554a\uff01\uff01\uff01&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line">                            <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                <span class="punctuation">&#123;</span></span><br><span class="line">                                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;239950&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Twelve&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/PiajxSqBRaEJYL9G3UuHCjr2eZ9XK34j8YtpRzjl1TMeyM7BzsYPOdTOu55cQWT06iaYHev84PgcC0omyX6z8ymg\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-11&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u53ef\u4ee5\u5728\u5fae\u6155\u5546\u57ce\u4e0b\u8f7d\u4e86&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;70&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                    <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                                        <span class="punctuation">&#123;</span></span><br><span class="line">                                            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;240270&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\ue110Immortal\ud83c\udf40&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/cacXgAPOEMSyJpia8hXs6x9R5rVNGSbeTcxUpXHFh7SDRUToKZ4RPgvuTWO09Wt3pVvicMsz8icmcO7ic39gphzic4A\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-17&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u597d&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;15736&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                            <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">                                        <span class="punctuation">&#125;</span></span><br><span class="line">                                    <span class="punctuation">]</span></span><br><span class="line">                                <span class="punctuation">&#125;</span></span><br><span class="line">                            <span class="punctuation">]</span></span><br><span class="line">                        <span class="punctuation">&#125;</span></span><br><span class="line">                    <span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;239964&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;author_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Twelve&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;author_url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/thirdwx.qlogo.cn\/mmopen\/vi_32\/PiajxSqBRaEJYL9G3UuHCjr2eZ9XK34j8YtpRzjl1TMeyM7BzsYPOdTOu55cQWT06iaYHev84PgcC0omyX6z8ymg\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-01-14&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5728\u5fae\u6155\u5546\u57ce\u53ef\u4ee5\u4e0b\u8f7d\u4e86&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;formId&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;70&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;child&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<p>数据库表设计；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sw_father_reply` (</span><br><span class="line">  `id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `post_id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` text <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `receiver_nick` <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `father_reply_date` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">16</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sw_son_reply` (</span><br><span class="line">  `id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `post_id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `father_reply_id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `user_id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` text <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `receiver_nick` <span class="type">char</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `son_reply_date` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">11</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb3;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> spc.id, spc.name, spc.description, spc.category_thumbnail_image, <span class="built_in">count</span>(sp.id) <span class="keyword">as</span> posts_count</span><br><span class="line">       <span class="keyword">from</span> sw_post_categories spc</span><br><span class="line">                <span class="keyword">left</span> <span class="keyword">join</span> sw_posts sp <span class="keyword">on</span> sp.category_id <span class="operator">=</span> spc.id</span><br><span class="line">       <span class="keyword">group</span> <span class="keyword">by</span> spc.id</span><br><span class="line">       <span class="keyword">order</span> <span class="keyword">by</span> posts_count <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>



<p>后端实现过程：</p>
<blockquote>
<p>后端开发 &gt; MyBatis &gt; Bilibili评论列表</p>
</blockquote>
<h4 id="帖子分类并计数"><a href="#帖子分类并计数" class="headerlink" title="帖子分类并计数"></a>帖子分类并计数</h4><blockquote>
<p>以下的信息只有分析过小程序源码后分析得出的，可以观察到其实小程序前端就不像是WordPress Web前端那样，或许WordPress数据库内的所有字段也不会被它的前端全部用上，但至少要考虑小程序只有80后端端口才可以被使用，要考虑到后期租服务器，比如阿里云，租的服务器可是要按照带宽大小收费的，后期的话，图片媒体类的服务器也是到时候也是要考虑是否可以使用自己家里的服务器（非80）。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/voilethht/article/details/47424517">CSDN:多表计数查询作业</a></p>
</blockquote>
<p>小程序源码：</p>
<p><img src="/images/java_dev/image-20220328200423228.png" alt="image-20220328200423228"></p>
<p>分析之后其实可以得出，我们小程序项目其实没必要那么多比必要的数据，或者维护这些数据还需要更多的后端代码来管理字段。</p>
<p>以下信息分析过小程序源码后得出下面的标注“关键数据”之外的数据其实对于小程序来说是没有用的，简化数据库后期代码维护会变得相对简单。</p>
<p>对应WordPress调用网站后端接口 <a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/wp/v2/categories?per_page=100&orderby=count&order=desc&openid=">https://www.watch-life.net/wp-json/wp/v2/categories?per_page=100&amp;orderby=count&amp;order=desc&amp;openid=</a> ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">557</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;count&quot;</span><span class="punctuation">:</span> <span class="number">128</span><span class="punctuation">,</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u6709\u5173Visual Studio2005\u3001Visual Studio2008\u3001Visual Studio2010\u7684\u6587\u7ae0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/category\/visual-studio&quot;</span><span class="punctuation">,</span></span><br><span class="line">    </span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Visual Studio&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;slug&quot;</span><span class="punctuation">:</span> <span class="string">&quot;visual-studio&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;taxonomy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;category&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;parent&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;meta&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;subimg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;subscription.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;subflag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0&quot;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;category_thumbnail_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/visual-studio.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;_links&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;self&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/wp-json\/wp\/v2\/categories\/557&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;collection&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/wp-json\/wp\/v2\/categories&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;about&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/wp-json\/wp\/v2\/taxonomies\/category&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;wp:post_type&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/wp-json\/wp\/v2\/posts?categories=557&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;curies&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                <span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;wp&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;href&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/api.w.org\/&#123;rel&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="attr">&quot;templated&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>



<p>数据库表设计：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sw_post_categories` (</span><br><span class="line">  `id` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `name` <span class="type">char</span>(<span class="number">50</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">DEFAULT</span> <span class="string">&#x27;没有描述~&#x27;</span>,</span><br><span class="line">  `category_thumbnail_image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  <span class="keyword">UNIQUE</span> KEY `categorie_name_UNIQUE` (`name`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">19</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br></pre></td></tr></table></figure>



<p>查询语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> spc.id,spc.name ,spc.description,spc.category_thumbnail_image,<span class="built_in">count</span>(sp.id) <span class="keyword">as</span> posts_count <span class="keyword">from</span> sw_post_categories spc <span class="keyword">left</span> <span class="keyword">join</span> sw_posts sp <span class="keyword">on</span> sp.category_id<span class="operator">=</span>spc.id <span class="keyword">group</span> <span class="keyword">by</span> spc.id  <span class="keyword">order</span> <span class="keyword">by</span> posts_count <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>



<p>后端实现过程：</p>
<blockquote>
<p>后端开发 &gt; MyBatis &gt; 帖子分类列表</p>
</blockquote>
<h4 id="根据分类ID获取所有该ID下的帖子并翻页-2"><a href="#根据分类ID获取所有该ID下的帖子并翻页-2" class="headerlink" title="根据分类ID获取所有该ID下的帖子并翻页"></a>根据分类ID获取所有该ID下的帖子并翻页</h4><blockquote>
<p>这个功能模块也是需要Json数据分析的，使用的表跟之前的有所重复，我们调用WordPress接口直接分析JSON数据。规划后端代码操作数据库返回小程序所需JSON数据即可。</p>
</blockquote>
<p>小程序源码：</p>
<p>以下元素名称都要和自己后端对应起来，所以下面的变量就符合Java变量命名规格。</p>
<p><img src="/images/java_dev/image-20220401203514005.png" alt="image-20220401203514005"></p>
<p>调用WordPress后端接口标注关键数据<a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/watch-life-net/v1/posts?per_page=10&orderby=date&order=desc&page=1&categories=1%EF%BC%9A">https://www.watch-life.net/wp-json/watch-life-net/v1/posts?per_page=10&amp;orderby=date&amp;order=desc&amp;page=1&amp;categories=1：</a></p>
<p>分析这个链接其实就可以明白它的意思，<code>per_page=10</code>每页10个、<code>orderby=date&amp;order=desc</code>按照时间倒序，即新的在前面，<code>page=1</code>第一页，<code>categories=1</code>哪个分类ID。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取到的是一个列表，本来有10个元素的，为了简洁就放一个元素。</span></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2006</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T11:53:54&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;date_gmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T03:53:54&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;guid&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/?p=2006&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;modified&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T12:38:43&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;modified_gmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13T04:38:43&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;slug&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a-slight-illness-logs&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;publish&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;post&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;link&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/life-thinking\/a-slight-illness-logs.html&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5fae\u6059\u7410\u8bb0&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;excerpt&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;rendered&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;p&gt;\u7528\u6742\u4e71\u65e0\u7ae0\u7684\u6587\u5b57\uff0c\u8bb0\u5f55\u4e00\u6bb5\u4f4f\u9662\u6cbb\u7597\u75d4\u75ae\u4e4b\u75be\u7684\u601d\u8003\uff0c\u4ee5\u6b64\u4f5c\u4e3a\u7eaa\u5ff5\u3002&lt;\/p&gt;\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;protected&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;author&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;featured_media&quot;</span><span class="punctuation">:</span> <span class="number">2007</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;open&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;ping_status&quot;</span><span class="punctuation">:</span> <span class="string">&quot;open&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;sticky&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;template&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="string">&quot;standard&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;meta&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;categories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">1</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="number">165</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">261</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">42</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">363</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">267</span><span class="punctuation">,</span></span><br><span class="line">            <span class="number">1186</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_thumbnail_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-113x150.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;content_first_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_medium_image_300&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-225x300.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_thumbnail_image_624&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_frist_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_medium_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-225x300.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_large_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_full_image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_all_images&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;imagesurl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2022\/03\/IMG_20220312_153337-769x1024.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;image0&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;videoAdId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;adunit-54154da9ac037533&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAd&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAdId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;adunit-04c7f94fa0c24c57&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;listAdEvery&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;total_comments&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;category_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u968f\u601d\u5076\u5f97&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;post_date&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-13&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;like_count&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment">//关键数据</span></span><br><span class="line">        <span class="attr">&quot;pageviews&quot;</span><span class="punctuation">:</span> <span class="number">555</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next_post_id&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;next_post_title&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;previous_post_id&quot;</span><span class="punctuation">:</span> <span class="number">1748</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;previous_post_title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u7236\u4eb2\u4e0d\u9700\u8981\u8282\u65e55&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br></pre></td></tr></table></figure>





<p>数据库表设计：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sw_posts` (</span><br><span class="line">  `id` <span class="type">bigint</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">bigint</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  `<span class="type">date</span>` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `content` longtext <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` text <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `enable` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  `modified` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `type` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  `total_comments` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `post_medium_image` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> utf8mb4_unicode_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;../../images/error.jpg&#x27;</span>,</span><br><span class="line">  `like_count` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `pageviews` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `category_id` <span class="type">int</span> unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `type_status_date` (`type`,`enable`,`<span class="type">date</span>`,`id`),</span><br><span class="line">  KEY `author` (`user_id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">1962</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 <span class="keyword">COLLATE</span><span class="operator">=</span>utf8mb4_unicode_ci;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<p>MyBatis Plus下的操作，无SQL。</p>
<p>后端实现过程：</p>
<blockquote>
<p>后端开发 &gt; MyBatis Plus &gt; 根据分类ID获取所有该ID下的帖子并翻页</p>
</blockquote>
<h2 id="前端开发"><a href="#前端开发" class="headerlink" title="前端开发"></a>前端开发</h2><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fengff/p/10843728.html">四种常见的 POST 提交数据方式（application&#x2F;x-www-form-urlencoded，multipart&#x2F;form-data，application&#x2F;json，text&#x2F;xml） 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/iamxjb/winxin-app-watch-life.net">GitHub：微慕小程序开源版-WordPress版微信小程序</a></p>
</blockquote>
<h3 id="Json-server"><a href="#Json-server" class="headerlink" title="Json-server"></a>Json-server</h3><blockquote>
<p>由于刚开始有一个可进行二次开发的小程序，但后端只能自己写，为了方便理解代码的运作方式以及测试内部API的以便进行后期代码的修改测试，分析小程序后端数据库以方便建立适合的数据表。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://github.com/typicode/json-server">Github:json-server</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9cfc5cdb0aeb">简书：json-server全攻略</a></p>
<p><a target="_blank" rel="noopener" href="https://www.watch-life.net/">WordPress：守望生活, 审视自我,宁静雅致的小轩馆</a></p>
</blockquote>
<h4 id="基于前后端分离"><a href="#基于前后端分离" class="headerlink" title="基于前后端分离"></a>基于前后端分离</h4><p>其中最有用的还是自定义路由功能，可进行模仿小程序内部请求的API进行数据响应，比如我的小程序需要调用API：<a target="_blank" rel="noopener" href="https://www.watch-life.net/wp-json/watch-life-net/v1/options/homeconfig">https://www.watch-life.net/wp-json/watch-life-net/v1/options/homeconfig</a>，返回小程序所需要的数据，当然后期也不一定遵循和小程序原先请求的API一模一样，可以根据自己的需求进行更改，更改好后再修改小程序内部源码进行添加一些需求或者去掉一些不需要的数据解析，这样以来对后端数据库的设计也是很有帮助的。</p>
<p>请求原后端API返回Json数据：</p>
<p><img src="/images/java_dev/get_json.png" alt="浏览器请求后端API接口"></p>
<p>由于目前基本上都是使用的前后端分离的形式来进行项目开发的，所以只要是调用API基本上后端都是以JSON形式返回数据，这无论是对开发或者是对一个后端项目进行小程序、Android、网页前端开发，都是非常方便的，当然这些都是前后端分离的成效！</p>
<h4 id="Json-server-运行"><a href="#Json-server-运行" class="headerlink" title="Json-server 运行"></a>Json-server 运行</h4><p><img src="/images/java_dev/json_server_run.png" alt="Json-server"></p>
<ul>
<li><p><code>-r route.json</code> 配置了路由：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;/schoolwall/options/homeconfig&quot;</span><span class="punctuation">:</span><span class="string">&quot;/get_homeconfig&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;/schoolwall/posts?per_page=10&amp;orderby=date&amp;order=desc&amp;page=1&quot;</span><span class="punctuation">:</span><span class="string">&quot;/getposts&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-w index.json</code> 配置了请求响应的数据：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;downloadfileDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;thirdwx.qlogo.cn,www.watch-life.net,wx.qlogo.cn,blog.minapper.com,www.minapper.com,shops.minapper.com&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;businessDomain&quot;</span><span class="punctuation">:</span> <span class="string">&quot;blog.minapper.com,plus.minapper.com,blog.minapper.com,www.minapper.com,www.watch-life.net&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;zanImageurl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2021\/02\/\u5fae\u4fe1\u56fe\u7247_20210201182058.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;logoImageurl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2021\/01\/watch-life.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;expand&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;swipe_nav&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apppage&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2021\/02\/\u5fae\u4fe1\u56fe\u7247_20210201093932-1-scaled.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\/pages\/detail\/detail?id=1827&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yes&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5fae\u6155\u5c0f\u7a0b\u5e8f\u4e13\u4e1a\u7248V3.6-\u89c6\u9891\u53f7\u6269\u5c55&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apppage&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2019\/07\/miapper-plus2.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\/pages\/detail\/detail?id=1773&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yes&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5fae\u6155WordPress\u5c0f\u7a0b\u5e8f\u589e\u5f3a\u7248v2.0\u53d1\u5e03&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apppage&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;appid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;image&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\/\/www.watch-life.net\/images\/2019\/11\/minapper.jpg&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\/pages\/detail\/detail?id=1840&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;enable&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yes&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;\u5fae\u6155\u5c0f\u7a0b\u5e8f\u5f00\u6e90\u7248v4.0\u53d1\u5e03&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p><code>-c config.json</code>配置了可以进行外部主机访问：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span><span class="string">&quot;0.0.0.0&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>由于这里的默认配置是localhost，但不能进行局域网内部的访问，所以改写了默认配置，可用小程序开发者工具生成二维码供开发者进行局域网内部互相访问，当然开启使用预览功能得是小程序的开发者（Appid要和自己开发的Appid一致）或者去<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/devtools/sandbox.html">小程序开发者测试号申请</a>：</p>
<p><img src="/images/java_dev/mini_app.png" alt="image-20220224225244380"></p>
</li>
</ul>
<h3 id="小程序登录逻辑"><a href="#小程序登录逻辑" class="headerlink" title="小程序登录逻辑"></a>小程序登录逻辑</h3><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/ebook?action=get_post_info&docid=000cc48f96c5989b0086ddc7e56c0a">微信开放社区：微信登录</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html">微信开放社区：Session_key开放数据校验与解密</a></p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/storage/wx.setStorage.html">微信开发者官网：wx.setStorage(Object object)</a></p>
</blockquote>
<p><img src="/images/java_dev/wxapplogin.png" alt="来自官网的登录逻辑图"></p>
<p>小程序登录步骤：</p>
<ol>
<li><p><strong>小程序</strong>用<code>wx.login()</code>首先向<strong>微信服务器</strong>请求一个Code，Code请求成功返回给小程序端，此Code（微信登录凭证）只有5分钟内有效期，如果<strong>5分钟内小程序的后台不拿着这个临时身份证来微信后台服务器换取微信用户id的话，那么这个身份证就会被作废</strong>。</p>
<ol>
<li>点击小程序端同意授权，调用<code>wx.getUserProfile()</code>success后才能获取用户其他信息（头像，微信网名）。</li>
<li><strong>小程序</strong>用<code>wx.request()</code>带着临时<strong>Code</strong>和<strong>其他信息</strong>到自己的后台(<strong>三方服务器</strong>)，如果查询到后台服务器（<strong>三方服务器</strong>）没有进行用户的绑定就会验证三方服务器中的用户名和密码通过后才能进行下一个步骤。</li>
</ol>
</li>
<li><p>如果绑定了<strong>三方服务器</strong>就会访问带有code2Session的微信服务器API加上参数Code，*<em><strong>AppID</strong>和</em>*AppSecret（<strong>微信服务器</strong>为了确保拿过来的Code就是刚刚对应的小程序开发者）等信息从微信服务器获得JSON格式的openid和session_key信息。</p>
<ul>
<li>如果发现泄露了AppSecret，就要进行重置（重置会导致Code成功换取一次信息后直接失效，即便生成openID、session_key，等…  的时间还没有到期）。</li>
</ul>
</li>
<li><p>发送请求Code到微信服务器接口<a target="_blank" rel="noopener" href="https://api.weixin.qq.com/sns/jscode2session?appid=%3CAppId%3E&amp;secret=%3CAppSecret%3E&amp;js_code=%3Ccode%3E&amp;grant_type=authorization_code">https://api.weixin.qq.com/sns/jscode2session?appid=%3CAppId%3E&amp;secret=%3CAppSecret%3E&amp;js_code=%3Ccode%3E&amp;grant_type=authorization_code</a>（AppID  AppSecret  Code）后会响应三个参数：</p>
<table>
<thead>
<tr>
<th align="left"><strong>字段</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">openid</td>
<td align="left">微信用户的唯一标识</td>
</tr>
<tr>
<td align="left">session_key</td>
<td align="left">会话密钥，未过期预示着微信用户已登录</td>
</tr>
<tr>
<td align="left">unionid</td>
<td align="left">用户在微信开放平台的唯一标识符。本字段在满足一定条件的情况下才返回。</td>
</tr>
</tbody></table>
<ul>
<li><p>openid:即微信用户ID，用来区分不同的微信用户身份。</p>
</li>
<li><p>session_key：如果我们每次都通过小程序前端wx.login()生成微信登录凭证code去微信服务器请求信息，步骤太多造成整体耗时比较严重，因此对于一个比较可信的服务端，给开发者服务器颁发一个时效性更长的会话密钥就显得很有必要了。</p>
</li>
<li><p>获取到openid（微信用户身份ID）和自己服务器的用户ID需要进行一个绑定。有了这个绑定信息，小程序在下次需要用户登录的时候就可以不需要输入账号密码，可以直接使用用户的微信身份openid，通过绑定信息就可以查出后端的用户身份id，直接就可以进行登录操作。</p>
</li>
</ul>
</li>
<li><p>业务凭证SessionID：小程序后端对小程序登录后发布的SessionID，此时要进行跨域处理，所以后端必须用上<code>shiro+jwt(Json web token)</code> ，才可以解决这个跨域问题，就是上边提到的，客户端保存 token（通常是保存在Cookie或者LocalStorage中），而Session登录方式，客户端是自动执行服务器端将sessionId set到cookie中的命令，sessionId被自动保存在cookie中的。</p>
</li>
</ol>
<p>测试Code获取OpenID</p>
<p><img src="/images/java_dev/image-20220421112226908.png" alt="image-20220421112226908"></p>
<p>后端code失效测试</p>
<p><img src="/images/java_dev/image-20220421113735360.png" alt="image-20220421113735360"></p>
<h4 id="Session-key作用"><a href="#Session-key作用" class="headerlink" title="Session_key作用"></a>Session_key作用</h4><p><img src="/images/java_dev/signature.8a30a825.jpg" alt="signature.8a30a825"></p>
<p>总结：Code（5分钟有效）为了换取用户OpenID（相当于身份证号码），Code换取OpenID之后，微信服务器才会在内部设置Session_key（有效期根据用户活跃度而定），Session_key作用在官网描述为用它可以校验客户端数据获取的数据的完整性，详见<a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/signature.html">开放数据校验与解密</a></p>
<h3 id="Bilibili评论列表-1"><a href="#Bilibili评论列表-1" class="headerlink" title="Bilibili评论列表"></a>Bilibili评论列表</h3><blockquote>
<p>参阅以下内容请先参阅：</p>
<ol>
<li>API规划 &gt; 小程序首页 &gt; 根据帖子ID获取评论列表</li>
<li>数据库设计 &gt; 数据分析 &gt; 评论列表</li>
<li>后端开发 &gt; MyBatis </li>
<li>后端开发 &gt; MyBatis Plus &gt; 分页插件</li>
</ol>
<p>由于前面分析过WordPress实现的评论列表是经典套娃型的列表，不符合校园墙这样的需要频繁交流的平台，但参考了网上Java实现类似Bilibili评论列表的方式又含糊不清，于是自己琢磨一个和Bilibili一样的评论列表出来也是必不可少的。</p>
<p>其中Bilibili这种评论列表的实现也少不了对评论列表进行一个分页处理的，但是分页列表也可放在后端进行，但后来在后端实现的时候用到了MyBatis Plus 的分页插件，我的这种实现方式其实可能是SQL语句写的不够优秀，只能导致关联表查询只能对子评论进行一个分页但不能对父级列表分类，直接将分页的组合放到前端去处理一下就可以了。</p>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/jsref/jsref-concat-array.html">菜鸟教程：concat()</a></p>
</blockquote>
<p>以下数据<code>&quot;total&quot;: 0</code>即说明了分页插件未开启全部数据的统计，由于评论这种类型的数据是需要不端进行修改和查询的，关闭数据统计可以节省服务器性能以及内存，当然这样对于前端逻辑判断比如是最后一页的设计的难度就会更大一些。</p>
<ul>
<li><p>调用本地后端接口<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=1%EF%BC%88%E7%AC%AC%E4%B8%80%E9%A1%B5%EF%BC%89%EF%BC%9A">http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=1（第一页）：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://syimg.3dmgame.com/uploadimg/xiaz/2021/0803/1627959355632.gif&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;瓜多少钱一斤啊&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fatherReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-16T20:35:12&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sonList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">8</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2.5一斤。&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:37:41&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">9</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://syimg.3dmgame.com/uploadimg/xiaz/2021/0803/1627959355632.gif&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;皮瓜金子做的还是瓜粒子金子做的？   看，吸铁石，另外你说的瓜要是生的你自己吞进去？！&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:38:54&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是故意找茬儿是不是？？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;华强&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:39:39&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>		<span class="comment">//父级评论ID</span></span><br><span class="line">                <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是哪位？？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fatherReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-17T20:22:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sonList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我是你**。&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:30:59&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;出来单挑啊？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:32:10&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>


</li>
<li><p>调用本地后端接口<a target="_blank" rel="noopener" href="http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=2%EF%BC%88%E7%AC%AC%E4%BA%8C%E9%A1%B5%EF%BC%89%EF%BC%9A">http://0.0.0.0:3000/schoolwall/getcomments/postid=123/commentspage=2（第二页）：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">200</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;操作成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;records&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>		<span class="comment">//父级评论ID</span></span><br><span class="line">                <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你是哪位？？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;fatherReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-17T20:22:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;sonList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;单挑啊&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:33:11&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;来啊&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:34:16&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你打我&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:34:51&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://ding-f.gitee.io/medias/detail/logo.png\n&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;我打你，你打我又怎样？&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:35:35&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                    <span class="punctuation">&#123;</span></span><br><span class="line">                        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">7</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;nickName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;水果摊摊主&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;avatarUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https:\\/\\/thirdwx.qlogo.cn\\/mmopen\\/vi_32\\/JTQ8vfn8CDFaNQ55EPtfVibEBESvV8UAb9E5JiahibwKLbKG41HJxRib2uhpleutD4EiajNKkibV7bQWb83qvxicQdaibQ\\/132&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;你有没有砍过人&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;receiverNick&quot;</span><span class="punctuation">:</span> <span class="string">&quot;铸鼎_&quot;</span><span class="punctuation">,</span></span><br><span class="line">                        <span class="attr">&quot;sonReplyDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-03-20T19:36:24&quot;</span></span><br><span class="line">                    <span class="punctuation">&#125;</span></span><br><span class="line">                <span class="punctuation">]</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;total&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;current&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;orders&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;searchCount&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;pages&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>上面注释了父级ID翻页后第二页与第一页结果是一样的，学习过MySQL数据库的都知道，多表查询中的左联查询数据库执行分页，当然是分的相当是右边的页面，因为左边是重的。</p>
<p>虽然可以在后端也可以进行一个两个父级的结合，但最好还是放在前端进行两个相同父级结合最符合常理。</p>
<p>前端实现结合相同父级的子列表：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> resFatherList = response.<span class="property">data</span>.<span class="property">data</span>.<span class="property">records</span>;		<span class="comment">//底部刷新事件获取到的评论数据(调用API接口返回数据)</span></span><br><span class="line"><span class="keyword">var</span> locaList=<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">commentsList</span>;		<span class="comment">//本地data:&#123;&#125;评论列表</span></span><br><span class="line"></span><br><span class="line">             <span class="comment">// mark: 评论列表的合成</span></span><br><span class="line">            <span class="keyword">if</span>(locaList[<span class="number">0</span>] &amp;&amp; resFatherList[<span class="number">0</span>])&#123;</span><br><span class="line">              <span class="keyword">var</span> locaListLast = locaList.<span class="title function_">slice</span>(-<span class="number">1</span>)[<span class="number">0</span>];    <span class="comment">//复制出最后一个元素</span></span><br><span class="line">              <span class="keyword">var</span> resListFirst= resFatherList.<span class="title function_">slice</span>(<span class="number">0</span>,<span class="number">1</span>)[<span class="number">0</span>];    <span class="comment">//复制出第一个元素</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">              </span><br><span class="line">              <span class="keyword">if</span>(locaListLast.<span class="property">id</span> === resListFirst.<span class="property">id</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> unionSon = resFatherList.<span class="title function_">shift</span>().<span class="property">sonList</span>;    <span class="comment">//返回削去response子第一个父评论的子列表</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> locaLastSon=locaListLast.<span class="property">sonList</span>.<span class="title function_">concat</span>(unionSon);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// console.log(locaLastSon);</span></span><br><span class="line">                <span class="comment">// console.log(locaList);</span></span><br><span class="line"></span><br><span class="line">                locaList[locaList.<span class="property">length</span>-<span class="number">1</span>].<span class="property">sonList</span>=locaLastSon;    </span><br><span class="line">              &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 评论列表 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">style</span>=<span class="string">&quot;display:&#123;&#123;display&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;comment-container&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 小标题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;subTitle&quot;</span> <span class="attr">id</span>=<span class="string">&quot;relatedTitle&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span>&gt;</span>评论交流<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;comment-num&quot;</span>&gt;</span>&#123;&#123;commentCount&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;subTitle_line subTitle_line_comment&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 列表 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:key</span>=<span class="string">&quot;id&quot;</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;commentsList&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;comment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;comment-user&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">image</span> <span class="attr">src</span>=<span class="string">&quot;&#123;&#123;item.avatarUrl&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;comment-gravatar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;comment-user-right&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- data-userid=&quot;&#123;&#123;item.userid&#125;&#125;&quot; data-formId=&quot;&#123;&#123;item.formId&#125;&#125;&quot; --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">bindtap</span>=<span class="string">&quot;replay&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item.nickName&#125;&#125;&quot;</span>  <span class="attr">data-commentdate</span>=<span class="string">&quot;&#123;&#123;item.fatherReplyDate&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;item.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;time&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;replay&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item.nickName&#125;&#125;&quot;</span>  <span class="attr">data-commentdate</span>=<span class="string">&quot;&#123;&#123;item.fatherReplyDate&#125;&#125;&quot;</span>&gt;</span>&#123;&#123;item.fatherReplyDate&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;comment-summary&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;replay&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item.id&#125;&#125;&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item.author_name&#125;&#125;&quot;</span> <span class="attr">data-userid</span>=<span class="string">&quot;&#123;&#123;item.userid&#125;&#125;&quot;</span> <span class="attr">data-formId</span>=<span class="string">&quot;&#123;&#123;item.formId&#125;&#125;&quot;</span> <span class="attr">data-commentdate</span>=<span class="string">&quot;&#123;&#123;item.date&#125;&#125;&quot;</span>&gt;</span> &#123;&#123;item.content&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 子回复--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">wx:for</span>=<span class="string">&quot;&#123;&#123;item.sonList&#125;&#125;&quot;</span> <span class="attr">wx:key</span>=<span class="string">&quot;itemid1&quot;</span> <span class="attr">wx:for-index</span>=<span class="string">&quot;idx&quot;</span> <span class="attr">wx:for-item</span>=<span class="string">&quot;item1&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;replay-user&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;replay&quot;</span> <span class="attr">data-id</span>=<span class="string">&quot;&#123;&#123;item1.id&#125;&#125;&quot;</span> <span class="attr">data-name</span>=<span class="string">&quot;&#123;&#123;item1.nickName&#125;&#125;&quot;</span>   <span class="attr">data-commentdate</span>=<span class="string">&quot;&#123;&#123;item1.sonReplyDate&#125;&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;comment-username&quot;</span>&gt;</span>&#123;&#123;item1.nickName&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">style</span>=<span class="string">&quot;margin: 0 6rpx; color: #959595;&quot;</span>&gt;</span>回复<span class="tag">&lt;/<span class="name">text</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span> <span class="attr">class</span>=<span class="string">&quot;comment-username&quot;</span>&gt;</span>&#123;&#123;item1.receiverNick&#125;&#125;<span class="tag">&lt;/<span class="name">text</span>&gt;</span> ：&#123;&#123;item1.content&#125;&#125;</span><br><span class="line">          <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 子回复--&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p>实现效果：</p>
<p>本来铸鼎_的评论是分开的显示两个评论块，但合一后铸鼎_的子评论刷新时合在了一起</p>
<p><img src="/images/java_dev/2022-03-29_14.44.35.gif" alt="2022-03-29 14.44.35"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://ding-f.github.io">付鼎</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://ding-f.github.io/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji">https://ding-f.github.io/2022/02/13/java-bi-ye-she-ji-kai-fa-bi-ji</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ding-f.github.io" target="_blank">铸鼎_</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/JavaEE/">JavaEE</a><a class="post-meta__tags" href="/tags/SQL/">SQL</a><a class="post-meta__tags" href="/tags/%E7%90%86%E8%AE%BA/">理论</a><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF/">后端</a><a class="post-meta__tags" href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/">微服务</a><a class="post-meta__tags" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/">小程序</a></div><div class="post_share"><div class="social-share" data-image="/images/java_dev/graduate.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/reward/alipay.png" target="_blank"><img class="post-qr-code-img" src="/images/reward/alipay.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li><li class="reward-item"><a href="/images/reward/alipay_red.png" target="_blank"><img class="post-qr-code-img" src="/images/reward/alipay_red.png" alt="🧧"/></a><div class="post-qr-code-desc">🧧</div></li><li class="reward-item"><a href="/images/reward/wechat.png" target="_blank"><img class="post-qr-code-img" src="/images/reward/wechat.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/21/maven" title="Maven"><img class="cover" src="/images/maven/apache-maven.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Maven</div></div></a></div><div class="next-post pull-right"><a href="/2022/01/19/vue" title="Vue.JS"><img class="cover" src="/images/vue/vue.webp" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Vue.JS</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/04/11/apache-shiro-jwt" title="Apache Shiro + JWT"><img class="cover" src="/images/shir_jwt/shiro_jwt.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-11</div><div class="title">Apache Shiro + JWT</div></div></a></div><div><a href="/2022/07/27/java-wei-fu-wu" title="Java 微服务"><img class="cover" src="/images/2022-07-27-Java-%E5%BE%AE%E6%9C%8D%E5%8A%A1/v2-05ffc3ebd00f9ff4b1f5922649694e6b_1440w.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-07-27</div><div class="title">Java 微服务</div></div></a></div><div><a href="/2022/10/29/qi-ye-ji-xiao-cheng-xu-qian-hou-duan-kai-fa-bi-ji" title="企业级小程序全栈开发笔记"><img class="cover" src="/images/2022-10-29-%E4%BC%81%E4%B8%9A%E7%BA%A7%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%89%8D%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/R-C.0cb0ecbe4912bad8c6abe125e8d056a3rik=XDrLdRz%252fgxsuiw&riu=http%253a%252f%252fstatics.ovopic.com%252fUpload%252fimgs%252fc705055de8881080%252f1.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-10-29</div><div class="title">企业级小程序全栈开发笔记</div></div></a></div><div><a href="/2022/11/23/wei-xin-gong-zhong-hao-kai-fa-bi-ji" title="企业微信公众号开发笔记"><img class="cover" src="/images/2022-11-23-%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/R-C.86e392717a70a00f09abcd8173189293rik=JhyQ%252bGKjXFHkyQ&riu=http%253a%252f%252fpic.baike.soso.com%252fp%252f20140605%252f20140605161236-1949656822.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-11-23</div><div class="title">企业微信公众号开发笔记</div></div></a></div><div><a href="/2023/02/16/uni-app" title="uni-app"><img class="cover" src="/images/2023-02-16-uni-app/d490d7b4576290f-7-600x338.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-16</div><div class="title">uni-app</div></div></a></div><div><a href="/2021/03/08/spring" title="Spring"><img class="cover" src="/images/java_ee/spring.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-03-08</div><div class="title">Spring</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/logo.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">付鼎</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">65</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">13</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/ding-f"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=OK8IvfGeK0mn9ocBK1YcJKdY2No_KXoR" target="_blank" title="QQ"><i class="fa-brands fa-qq" style="color: #74C0FC;"></i></a><a class="social-icon" href="mailto:g00gleding@gmail.com" target="_blank" title="Email"><i class="fa-regular fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%94%BE%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-number">1.</span> <span class="toc-text">开放源代码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%98%85%E8%AF%BB"><span class="toc-number">2.</span> <span class="toc-text">推荐阅读</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#API%E8%A7%84%E5%88%92"><span class="toc-number">3.</span> <span class="toc-text">API规划</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#RESTful-API"><span class="toc-number">3.1.</span> <span class="toc-text">RESTful API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82-%E5%8A%A8%E8%AF%8D-%E5%AE%BE%E8%AF%AD"><span class="toc-number">3.1.1.</span> <span class="toc-text">请求 &#x3D; 动词 + 宾语</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#API-%E5%93%8D%E5%BA%94%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.1.2.</span> <span class="toc-text">API 响应设计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%9B%9E%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-number">3.1.3.</span> <span class="toc-text">服务器回应数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#API%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7Swagger3"><span class="toc-number">3.2.</span> <span class="toc-text">API管理工具Swagger3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E9%A6%96%E9%A1%B5"><span class="toc-number">3.3.</span> <span class="toc-text">小程序首页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E9%A1%B5%E8%BD%AE%E6%92%AD%E5%9B%BE%E5%92%8C%E7%B2%BE%E9%80%89%E5%86%85%E5%AE%B9"><span class="toc-number">3.3.1.</span> <span class="toc-text">首页轮播图和精选内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E7%AF%87%E5%B8%96%E5%AD%90%E4%B8%BA1%E9%A1%B5%EF%BC%8C%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E5%88%97%E8%A1%A8"><span class="toc-number">3.3.2.</span> <span class="toc-text">10篇帖子为1页，分页获取列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B8%96%E5%AD%90ID%E8%8E%B7%E5%8F%96%E5%B8%96%E5%AD%90%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">3.3.3.</span> <span class="toc-text">根据帖子ID获取帖子详细信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%B8%96%E5%AD%90ID%E8%8E%B7%E5%8F%96%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8%E5%B9%B6%E5%AE%9E%E7%8E%B0%E7%BF%BB%E9%A1%B5"><span class="toc-number">3.3.4.</span> <span class="toc-text">根据帖子ID获取评论列表并实现翻页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E5%88%86%E7%B1%BB%E9%A1%B5"><span class="toc-number">3.4.</span> <span class="toc-text">小程序分类页</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B8%96%E5%AD%90%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8%E5%B9%B6%E8%AE%A1%E7%AE%97%E7%B1%BB%E5%88%AB%E4%B8%8B%E8%B4%B4%E5%AD%90%E6%95%B0"><span class="toc-number">3.4.1.</span> <span class="toc-text">获取帖子分类列表并计算类别下贴子数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BBID%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF"><span class="toc-number">3.4.2.</span> <span class="toc-text">根据分类ID获取某个分类信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BBID%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E8%AF%A5ID%E4%B8%8B%E7%9A%84%E5%B8%96%E5%AD%90%E5%B9%B6%E7%BF%BB%E9%A1%B5"><span class="toc-number">3.4.3.</span> <span class="toc-text">根据分类ID获取所有该ID下的帖子并翻页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%96%87%E7%AB%A0%E6%88%96%E6%A0%87%E9%A2%98%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="toc-number">3.4.4.</span> <span class="toc-text">搜索文章或标题功能的实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">4.</span> <span class="toc-text">后端开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IntelliJ-IDEA"><span class="toc-number">4.1.</span> <span class="toc-text">IntelliJ IDEA</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAProject"><span class="toc-number">4.1.1.</span> <span class="toc-text">创建一个Project</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IDEA%E6%96%B0%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AAMode"><span class="toc-number">4.1.2.</span> <span class="toc-text">IDEA新创建一个Mode</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Maven"><span class="toc-number">4.2.</span> <span class="toc-text">Maven</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Boot"><span class="toc-number">4.3.</span> <span class="toc-text">Spring Boot</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AESpring-Boot%E5%8E%BB%E9%99%A4Json-Null%E5%80%BC%E5%85%83%E7%B4%A0"><span class="toc-number">4.3.1.</span> <span class="toc-text">配置Spring Boot去除Json Null值元素</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lombok"><span class="toc-number">4.4.</span> <span class="toc-text">Lombok</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MariaDB"><span class="toc-number">4.5.</span> <span class="toc-text">MariaDB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis-Plus"><span class="toc-number">4.6.</span> <span class="toc-text">MyBatis-Plus</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83"><span class="toc-number">4.6.1.</span> <span class="toc-text">准备环境</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">4.6.2.</span> <span class="toc-text">代码生成器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-number">4.6.3.</span> <span class="toc-text">分页插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E7%AF%87%E5%B8%96%E5%AD%90%E4%B8%BA1%E9%A1%B5%EF%BC%8C%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E5%88%97%E8%A1%A8-1"><span class="toc-number">4.6.4.</span> <span class="toc-text">10篇帖子为1页，分页获取列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BBID%E8%8E%B7%E5%8F%96%E6%9F%90%E4%B8%AA%E5%88%86%E7%B1%BB%E4%BF%A1%E6%81%AF-1"><span class="toc-number">4.6.5.</span> <span class="toc-text">根据分类ID获取某个分类信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BBID%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E8%AF%A5ID%E4%B8%8B%E7%9A%84%E5%B8%96%E5%AD%90%E5%B9%B6%E7%BF%BB%E9%A1%B5-1"><span class="toc-number">4.6.6.</span> <span class="toc-text">根据分类ID获取所有该ID下的帖子并翻页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%9C%E7%B4%A2%E6%96%87%E7%AB%A0%E6%88%96%E6%A0%87%E9%A2%98%E5%8A%9F%E8%83%BD%E7%9A%84%E5%AE%9E%E7%8E%B0-1"><span class="toc-number">4.6.7.</span> <span class="toc-text">搜索文章或标题功能的实现</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis"><span class="toc-number">4.7.</span> <span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%96%E5%AD%90%E5%88%86%E7%B1%BB%E5%88%97%E8%A1%A8"><span class="toc-number">4.7.1.</span> <span class="toc-text">帖子分类列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Bilibili%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">4.7.2.</span> <span class="toc-text">Bilibili评论列表</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Shiro-Redis-JWT"><span class="toc-number">4.8.</span> <span class="toc-text">Shiro Redis +JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JWT-%E5%8E%9F%E7%90%86"><span class="toc-number">4.8.1.</span> <span class="toc-text">JWT 原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JWT%E6%9B%BF%E6%8D%A2Session%E6%96%B9%E6%A1%88"><span class="toc-number">4.8.2.</span> <span class="toc-text">JWT替换Session方案</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Apache-Shiro%E5%86%85%E9%83%A8%E6%96%B9%E6%B3%95%E8%AF%B4%E6%98%8E"><span class="toc-number">4.8.3.</span> <span class="toc-text">Apache Shiro内部方法说明</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SHIRO-REDIS"><span class="toc-number">4.8.4.</span> <span class="toc-text">SHIRO-REDIS</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E8%AE%A4%E8%AF%81%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.8.5.</span> <span class="toc-text">跨域认证的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95-%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86"><span class="toc-number">4.9.</span> <span class="toc-text">测试&amp;问题处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Redis%E7%BC%93%E5%AD%98UUID%E7%9A%84Key-Value%E6%9C%89%E6%95%88%E6%9C%9F%E4%B8%8EJwt%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-number">4.9.1.</span> <span class="toc-text">Redis缓存UUID的Key-Value有效期与Jwt有效期</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Jwt%E9%87%8D%E6%96%B0%E7%AD%BE%E5%8F%91"><span class="toc-number">4.9.2.</span> <span class="toc-text">Jwt重新签发</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shiro-Session%EF%BC%88UUID%EF%BC%89%E7%89%B9%E6%80%A7"><span class="toc-number">4.9.3.</span> <span class="toc-text">Shiro Session（UUID）特性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD"><span class="toc-number">4.10.</span> <span class="toc-text">文件上传下载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">4.11.</span> <span class="toc-text">异常处理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1"><span class="toc-number">5.</span> <span class="toc-text">数据库设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">5.1.</span> <span class="toc-text">创建数据库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90"><span class="toc-number">5.2.</span> <span class="toc-text">数据分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10%E7%AF%87%E5%B8%96%E5%AD%90%E4%B8%BA1%E9%A1%B5%EF%BC%8C%E5%88%86%E9%A1%B5%E8%8E%B7%E5%8F%96%E5%88%97%E8%A1%A8-2"><span class="toc-number">5.2.1.</span> <span class="toc-text">10篇帖子为1页，分页获取列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8"><span class="toc-number">5.2.2.</span> <span class="toc-text">评论列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%96%E5%AD%90%E5%88%86%E7%B1%BB%E5%B9%B6%E8%AE%A1%E6%95%B0"><span class="toc-number">5.2.3.</span> <span class="toc-text">帖子分类并计数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B9%E6%8D%AE%E5%88%86%E7%B1%BBID%E8%8E%B7%E5%8F%96%E6%89%80%E6%9C%89%E8%AF%A5ID%E4%B8%8B%E7%9A%84%E5%B8%96%E5%AD%90%E5%B9%B6%E7%BF%BB%E9%A1%B5-2"><span class="toc-number">5.2.4.</span> <span class="toc-text">根据分类ID获取所有该ID下的帖子并翻页</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91"><span class="toc-number">6.</span> <span class="toc-text">前端开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Json-server"><span class="toc-number">6.1.</span> <span class="toc-text">Json-server</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB"><span class="toc-number">6.1.1.</span> <span class="toc-text">基于前后端分离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Json-server-%E8%BF%90%E8%A1%8C"><span class="toc-number">6.1.2.</span> <span class="toc-text">Json-server 运行</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%A8%8B%E5%BA%8F%E7%99%BB%E5%BD%95%E9%80%BB%E8%BE%91"><span class="toc-number">6.2.</span> <span class="toc-text">小程序登录逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Session-key%E4%BD%9C%E7%94%A8"><span class="toc-number">6.2.1.</span> <span class="toc-text">Session_key作用</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bilibili%E8%AF%84%E8%AE%BA%E5%88%97%E8%A1%A8-1"><span class="toc-number">6.3.</span> <span class="toc-text">Bilibili评论列表</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/11/26/qian-ru-shi-tong-xun-xie-yi" title="嵌入式通讯协议"><img src="/images/error.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="嵌入式通讯协议"/></a><div class="content"><a class="title" href="/2024/11/26/qian-ru-shi-tong-xun-xie-yi" title="嵌入式通讯协议">嵌入式通讯协议</a><time datetime="2024-11-25T18:37:22.000Z" title="发表于 2024-11-26 02:37:22">2024-11-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/16/lvm" title="LVM"><img src="/images/error.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="LVM"/></a><div class="content"><a class="title" href="/2024/07/16/lvm" title="LVM">LVM</a><time datetime="2024-07-16T00:12:29.000Z" title="发表于 2024-07-16 08:12:29">2024-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/09/linux-wang-luo-lu-you" title="Linux网络路由"><img src="/images/error.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Linux网络路由"/></a><div class="content"><a class="title" href="/2024/07/09/linux-wang-luo-lu-you" title="Linux网络路由">Linux网络路由</a><time datetime="2024-07-08T20:39:26.000Z" title="发表于 2024-07-09 04:39:26">2024-07-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/14/kua-yu-qing-qiu" title="跨域请求"><img src="/images/2024-06-14-%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82/1bb5dbbcf24047c59aa8f300ce6baec8.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="跨域请求"/></a><div class="content"><a class="title" href="/2024/06/14/kua-yu-qing-qiu" title="跨域请求">跨域请求</a><time datetime="2024-06-13T20:37:03.000Z" title="发表于 2024-06-14 04:37:03">2024-06-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/09/dian-zi-yuan-jian" title="电子元件"><img src="/images/2024-06-09-%E7%94%B5%E5%AD%90%E5%85%83%E4%BB%B6/d5a3f9ec8d634cb658645b38f9d74d.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="电子元件"/></a><div class="content"><a class="title" href="/2024/06/09/dian-zi-yuan-jian" title="电子元件">电子元件</a><time datetime="2024-06-08T20:23:34.000Z" title="发表于 2024-06-09 04:23:34">2024-06-09</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By 付鼎</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'ziXj4IBdz8gJoTTwpwRz1j1d-gzGzoHsz',
      appKey: 'cdWGyVSvxCcDKnMhlRaSvAJo',
      avatar: 'monsterid',
      serverURLs: 'https://zixj4ibd.lc-cn-n1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: true
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div></body></html>